var Ot=Object.defineProperty,It=Object.defineProperties;var Rt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Mt=Object.prototype.hasOwnProperty,Ft=Object.prototype.propertyIsEnumerable;var Ce=(s,e,t)=>e in s?Ot(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,E=(s,e)=>{for(var t in e||(e={}))Mt.call(e,t)&&Ce(s,t,e[t]);if(tt)for(var t of tt(e))Ft.call(e,t)&&Ce(s,t,e[t]);return s},I=(s,e)=>It(s,Rt(e));var l=(s,e,t)=>(Ce(s,typeof e!="symbol"?e+"":e,t),t);import{r as y,j as p,a as C,R as xe,C as R,_ as $,F as Ae,S as _t,I as rt,D as nt,b as Ut,B as Yt,m as Pe,U as Xt,L as Wt,P as Lt,u as Ht,c as Gt,M as J,d as Vt,e as zt}from"./vendor.30cc6a7b.js";const $t=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}};$t();function b(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}class v{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;b(this,"x",void 0),b(this,"y",void 0),this.x=e,this.y=t}clone(){return new v(this.x,this.y)}static Zero(){return new v(0,0)}point_add(e){var{x:t,y:r}=this;return new v(t+e.x,r+e.y)}countEndPointByRotate(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:v.Zero(),t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,{x:r,y:n}=this,[i,a]=[e.x,e.y],[o,h]=[r-i,n-a],f=o*Math.cos(t)-h*Math.sin(t),g=o*Math.sin(t)+h*Math.cos(t);return new v(f+i,g+a)}rotatePointOnZero(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,{x:t,y:r}=this;return new v(t*Math.cos(e)-r*Math.sin(e),t*Math.sin(e)+r*Math.cos(e))}transformPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[1,0,0,0,1,0],{x:t,y:r}=this;return new v(e[0]*t+e[2]*r+e[4],e[1]*t+e[3]*r+e[5])}translatePoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,{x:r,y:n}=this;return new v(r+e,n+t)}scalePoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,{x:r,y:n}=this;return new v(r*e,n*t)}countPointBaseTransform(e,t){return e.transFormPoint(this,t)}countPointBaseRotate(e){return e.rotatePoint(this)}}class qt{constructor(){b(this,"angle",0),b(this,"angleCenter",v.Zero())}takeEffect(e){var{angle:t,angleCenter:r}=this,{x:n,y:i}=r;t&&(e.translate(n,i),e.rotate(t),e.translate(-n,-i))}rotatePoint(e){var{angleCenter:t,angle:r}=this;return r&&(e=e.translatePoint(-t.x,-t.y),e=e.rotatePointOnZero(-r),e=e.translatePoint(t.x,t.y)),e}}class Qt{constructor(){b(this,"offsetX",0),b(this,"offsetY",0),b(this,"angle",0),b(this,"angleCenter",v.Zero()),b(this,"scaleX",1),b(this,"scaleY",1)}takeEffect(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{offsetX:r,offsetY:n,scaleX:i,scaleY:a,angle:o,angleCenter:h}=this,{isReset:f=!0,isScale:g=!0,isTranslate:c=!0,isRotate:m=!0}=t;if(f&&e.resetTransform(),c&&e.translate(r,n),m&&o){var{x,y:T}=h;o&&(e.translate(x,T),e.rotate(o),e.translate(-x,-T))}g&&e.scale(i,a)}transFormPoint(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{offsetX:r,offsetY:n,scaleX:i,scaleY:a,angleCenter:o,angle:h}=this,{isReset:f=!0,isScale:g=!0,isTranslate:c=!0,isRotate:m=!0}=t;return c&&(e=e.translatePoint(-r,-n)),m&&h&&(e=e.translatePoint(-o.x,-o.y),e=e.rotatePointOnZero(-h),e=e.translatePoint(o.x,o.y)),g&&(e=e.scalePoint(1/i,1/a)),e}}class S{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;b(this,"boxX",void 0),b(this,"boxY",void 0),b(this,"boxWidth",void 0),b(this,"boxHeight",void 0),this.boxX=e,this.boxY=t,this.boxWidth=r,this.boxHeight=n}get centerPoint(){var{boxX:e,boxY:t,boxWidth:r,boxHeight:n}=this;return new v(e+r/2,t+n/2)}static fromPoint(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5;return new S(e.x-t/2,e.y-r/2,r,t)}get boxPoints(){var{boxX:e,boxY:t,boxWidth:r,boxHeight:n}=this;return[new v(e,t),new v(e+r,t),new v(e+r,t+n),new v(e,t+n)]}isPointInFrame(e,t){var{x:r,y:n}=e,i=this.boxPoints,[a,o,h,f]=t?i.map(T=>T.countPointBaseRotate(t)):i,g=[a.x-r,a.y-n],c=[o.x-r,o.y-n],m=[h.x-r,h.y-n],x=[f.x-r,f.y-n];return g[0]*c[1]-c[0]*g[1]>0&&c[0]*m[1]-m[0]*c[1]>0&&m[0]*x[1]-x[0]*m[1]>0&&x[0]*g[1]-g[0]*x[1]>0}render(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},[r,n,i,a]=this.boxPoints,{fill:o="#ffffff00",stroke:h="#ffffff00"}=t;e.save(),e.fillStyle=o,e.strokeStyle=h,e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(n.x,n.y),e.lineTo(i.x,i.y),e.lineTo(a.x,a.y),e.closePath(),e.fill(),e.stroke(),e.restore()}}function be(s,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,i=new Image;if(i.setAttribute("crossOrigin","Anonymous"),r&&(i.width=r),n&&(i.height=n),!s){e(i);return}i.src=s,i.onload=()=>e(i),i.onerror=t}function Zt(s){try{return JSON.parse(JSON.stringify(s))}catch{return console.error(s,"\u4E0D\u662F\u4E00\u4E2AJSON\u6570\u636E"),{}}}function B(s,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!!e){for(var[n,i]of Object.entries(e))if(i!==void 0&&(!t||t.includes(n))){if(!r&&typeof i=="object")continue;s[n]=i}}}function it(s,e){var t={};for(var r of e){var n=s[r];n!==void 0&&(t[r]=n)}return t.type=s.type,t}function ue(s){var e=!1;return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e||(requestAnimationFrame(()=>{e=!1,s(...r)}),e=!0)}}function Kt(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=!1;return function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];t||(setTimeout(()=>{t=!1,s(...n)},e),t=!0)}}class we{set height(e){this._height=e,this.canvas.setAttribute("height","".concat(e))}get height(){return this._height}set width(e){this._width=e,this.canvas.setAttribute("width","".concat(e))}get width(){return this._width}toBase64(){return this.canvas.toDataURL("image/png")}constructor(e){b(this,"canvas",void 0),b(this,"ctx",void 0),b(this,"isInCanvas",!1),b(this,"_height",150),b(this,"_width",300),b(this,"baseOnPointerup",ue(a=>this.onPointerup(a))),b(this,"baseOnPointerdown",ue(a=>this.onPointerdown(a))),b(this,"baseOnPointermove",ue(a=>this.onPointermove(a))),b(this,"lastClickTime",0),b(this,"dblclickDelay",300),b(this,"documentOnPointermove",a=>{a.stopPropagation(),a.preventDefault();var o=this.dom2CanvasPoint(a.x,a.y);(o.x<=0||o.y<=0)&&(this.isInCanvas=!1,this.onPointerup(a))});var{width:t,height:r,canvas:n,dblclickDelay:i}=e;if(n?this.canvas=n:this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("\u6CA1\u6709 ctx");t?this.width=t:this._width=Number(this.canvas.getAttribute("width")),r?this.height=r:this._height=Number(this.canvas.getAttribute("height")),i&&(this.dblclickDelay=i),this.canvas.addEventListener("pointerdown",this.baseOnPointerdown),this.canvas.addEventListener("pointermove",this.baseOnPointermove),this.canvas.addEventListener("pointerup",this.baseOnPointerup),document.addEventListener("pointermove",this.documentOnPointermove)}destroy(){var{canvas:e}=this;e.removeEventListener("pointerdown",this.baseOnPointerdown),e.removeEventListener("pointermove",this.baseOnPointermove),e.removeEventListener("pointerup",this.baseOnPointerup),document.removeEventListener("pointermove",this.documentOnPointermove)}cancelDblclickEffect(){this.lastClickTime=0}dblclickCallback(e){}onPointerdown(e){e.stopPropagation(),e.preventDefault(),this.isInCanvas=!0;var t=Date.now();t-this.lastClickTime<this.dblclickDelay&&this.dblclickCallback(e),this.lastClickTime=t}onPointermove(e){e.stopPropagation(),e.preventDefault()}onPointerup(e){e.stopPropagation(),e.preventDefault()}dom2CanvasPoint(e,t){var{canvas:r,width:n,height:i}=this,{width:a,height:o,left:h,top:f}=r.getBoundingClientRect(),g=(e-h)/a*n,c=(t-f)/o*i;return new v(g,c)}clear(){var{ctx:e}=this;e.clearRect(0,0,this.width,this.height)}clearRect(e,t,r,n){this.ctx.clearRect(e,t,r,n)}fillRect(e,t,r,n){this.ctx.fillRect(e,t,r,n)}strokeRect(e,t,r,n){this.ctx.strokeRect(e,t,r,n)}setGlobalAlpha(e){this.ctx.globalAlpha=e}setGlobalCompositeOperation(e){this.ctx.globalCompositeOperation=e}setBackground(e){var{ctx:t,width:r,height:n}=this;t.save(),t.fillStyle=e,this.fillRect(0,0,r,n),t.restore()}onPoint(e){}drawPoint(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 0, 255, 0.2)",n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,{ctx:i}=this;i.save(),i.fillStyle=r,i.fillRect(e-n/2,t-n/2,n,n),i.restore()}drawLine(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 0, 255, 0.2)",n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"orange",{ctx:i}=this;i.save(),i.strokeStyle=r,i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke(),this.drawPoint(e.x,e.y,n),i.restore()}}function st(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function at(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?st(Object(t),!0).forEach(function(r){b(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):st(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function ke(s){var e=s.split(/\n/).map(r=>r+`
`),t=e.pop();return e.push(t.substring(0,t.length-1)),e}function jt(s){var e=ke(s);return e.map(t=>t.split(""))}class te extends S{constructor(){super(...arguments);b(this,"x",0),b(this,"y",0),b(this,"char","")}static from(e){var t=new te;return B(t,e),t}}function de(s,e,t,r){var n=t*1.23,{width:i}=s;return te.from({x:e.x,y:e.y,boxX:e.x,boxY:e.y,boxWidth:i,boxHeight:n,char:r})}function ot(s){for(var e=0,t=Number.MAX_VALUE,r=Number.MIN_VALUE,n=0;n<s.length;n++)e+=s[n].boxHeight,t=Math.min(t,s[n].boxX),r=Math.max(r,s[n].boxWidth);return te.from(at(at({},s[0]),{},{boxX:t,boxWidth:r,boxHeight:e}))}function ht(s,e,t){for(var r=0;r<s.length;r++){var n=s[r],{width:i}=e.measureText(n);if(i>t){for(var a="",o=0;o<n.length;o++)if(n[o]!==`
`){a+=n[o];var{width:h}=e.measureText(a+(n[o+1]||"")+`
`);h>t&&(s.splice(r,0,a+`
`),s[r+1]=n.slice(o+1),r++,a="")}}}}function Je(s){var e=document.createElement("canvas");e.height=s.height,e.width=s.width;var t=e.getContext("2d");return t.drawImage(s,0,0),t.getImageData(0,0,s.width,s.height)}async function er(s){var e=document.createElement("canvas");e.height=s.height,e.width=s.width;var t=e.getContext("2d");return t.putImageData(s,0,0),e.toDataURL()}function tr(s,e,t,r){var n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.2;s instanceof HTMLImageElement&&(s=Je(s));for(var i=e.data,a=s.data,o=0;o<s.width;o++)for(var h=0;h<s.height;h++){var[f,g]=[o+t,h+r],c=(g*e.width+f)*4,m=(h*s.width+o)*4;i[c]===255&&(De(i,a,c+0,m+0,n),De(i,a,c+1,m+1,n),De(i,a,c+2,m+2,n))}return s}function De(s,e,t,r,n){s[t]=Math.floor(s[t]*(1-n)+e[r]*n),s[t]>255&&(s[t]=255)}class lt extends we{constructor(e){super(e);var{coordInterval:t,backgroundColor:r}=e;r&&this.renderBackground(r),t&&this.renderCoord(t)}renderBackground(e){this.setBackground(e)}renderCoord(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"grey",{width:r,height:n}=this,i=e;i<r;i+=e)for(var a=e;a<n;a+=e)i===e&&this.ctx.fillText(a+"",i-10,a),a===e&&this.ctx.fillText(i+"",i,a-10),this.drawPoint(i,a,t)}}function Ne(s,e){if(!s)throw new Error("Invariant failed: "+(e||""))}function M(s,e){throw new Error("Unexpected object: "+s+`
`+e)}function d(s,e){if(!(s===void 0||e===void 0))switch(e){case"array":if(!Array.isArray(s))throw new Error("".concat(s," \u4E0D\u662F ").concat(e," \u7C7B\u578B"));return;case"object":case"number":case"string":case"boolean":case"null":if(typeof s!==e)throw new Error("".concat(s," \u4E0D\u662F ").concat(e," \u7C7B\u578B"));return;default:M(e)}}function A(s,e){if(!(s===void 0||e===void 0)&&!e.includes(s))throw new Error("".concat(s," \u4E0D\u5C5E\u4E8E ").concat(e))}function u(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}class Oe{static assertJsonTrue(e){}fromJSON(e){B(this,e,this.ATTRIBUTE_NAMES)}toJSON(){return it(this,this.ATTRIBUTE_NAMES)}static createObj(e,t){var r=new e;return r.fromJSON(t),r}}class L extends Oe{takeEffect(e){var t=this.ATTRIBUTE_NAMES;for(var r of t){var n=this[r];n!==void 0&&r in e&&(e[r]=n)}}}class rr extends L{constructor(){super(...arguments);u(this,"type","attr_origin"),u(this,"ATTRIBUTE_NAMES",["x","y"]),u(this,"x",0),u(this,"y",0)}toPoint(){return new v(this.x,this.y)}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{x:t,y:r}=e;d(t,"number"),d(r,"number")}}fromJSON(e){super.fromJSON(e)}}class Ie extends L{constructor(){super(...arguments);u(this,"type","attr_rotate"),u(this,"ATTRIBUTE_NAMES",["angle"]),u(this,"angle",0),u(this,"elementBox",void 0)}get angleCenter(){return this.elementBox?this.elementBox.centerPoint:v.Zero()}takeEffect(e){var{angle:t=0,angleCenter:r}=this,{x:n,y:i}=r;t&&(e.translate(n,i),e.rotate(t),e.translate(-n,-i))}rotatePoint(e){var{angleCenter:t,angle:r}=this;return r&&(e=e.translatePoint(-t.x,-t.y),e=e.rotatePointOnZero(-r),e=e.translatePoint(t.x,t.y)),e}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{angle:t}=e;d(t,"number")}}fromJSON(e){super.fromJSON(e)}}class re extends L{constructor(){super(...arguments);u(this,"pathBox",new S)}takeEffect(e,t){this.genPath(e,t)}}u(re,"ELEMENT_ATTRIBUTES",[]);class Re extends re{constructor(){super(...arguments);u(this,"type","rect"),u(this,"ATTRIBUTE_NAMES",["rx","ry","width","height","x","y"]),u(this,"rx",0),u(this,"ry",0),u(this,"width",0),u(this,"height",0),u(this,"x",0),u(this,"y",0)}genPath(e,t){var r=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,{width:i,height:a,x:o,y:h}=this,{origin:f}=t;o+=f.x,h+=f.y;var g=r!==0||n!==0,c=1-.5522847498;e.beginPath(),e.moveTo(o+r,h),e.lineTo(o+i-r,h),g&&e.bezierCurveTo(o+i-c*r,h,o+i,h+c*n,o+i,h+n),e.lineTo(o+i,h+a-n),g&&e.bezierCurveTo(o+i,h+a-c*n,o+i-c*r,h+a,o+i-r,h+a),e.lineTo(o+r,h+a),g&&e.bezierCurveTo(o+c*r,h+a,o,h+a-c*n,o,h+a-n),e.lineTo(o,h+n),g&&e.bezierCurveTo(o,h+c*n,o+c*r,h,o+r,h),this.pathBox=new S(o,h,i,a),e.closePath()}updatePathBox(e,t){var{boxX:r,boxY:n,boxWidth:i,boxHeight:a}=e,{origin:o}=t;i<=0||a<=0||(this.x=r-o.x,this.y=n-o.y,this.width=i,this.height=a)}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{rx:t,ry:r,width:n,height:i,x:a,y:o}=e;d(t,"number"),d(r,"number"),d(n,"number"),d(i,"number"),d(a,"number"),d(o,"number")}}fromJSON(e){super.fromJSON(e)}}class Me extends re{constructor(){super(...arguments);u(this,"type","ellipse"),u(this,"ATTRIBUTE_NAMES",["x","y","radiusX","radiusY","rotation","startAngle","endAngle","anticlockwise"]),u(this,"x",0),u(this,"y",0),u(this,"radiusX",0),u(this,"radiusY",0),u(this,"rotation",0),u(this,"startAngle",0),u(this,"endAngle",0),u(this,"anticlockwise",!0)}genPath(e,t){var{x:r=0,y:n=0,radiusX:i,radiusY:a,rotation:o,startAngle:h,endAngle:f,anticlockwise:g}=this,{origin:c}=t;e.beginPath(),o=o||0,h=h||0,f=f||2*Math.PI,r+=c.x,n+=c.y,e.ellipse(r,n,i,a,o,h,f,g),this.pathBox=new S(r-i,n-a,2*i,2*a),e.closePath()}updatePathBox(e,t){var{boxX:r,boxY:n,boxWidth:i,boxHeight:a}=e,{origin:o}=t;i<=0||a<=0||(this.radiusX=i/2,this.radiusY=a/2,this.x=r-o.x+this.radiusX,this.y=n-o.y+this.radiusY)}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{x:t,y:r,radiusX:n,radiusY:i,startAngle:a,endAngle:o,anticlockwise:h,rotation:f}=e;d(t,"number"),d(r,"number"),d(n,"number"),d(i,"number"),d(f,"number"),d(a,"number"),d(o,"number"),d(h,"boolean")}}fromJSON(e){super.fromJSON(e)}}class Fe extends re{constructor(){super(...arguments);u(this,"type","arc"),u(this,"ATTRIBUTE_NAMES",["x","y","radius","startAngle","endAngle","anticlockwise"]),u(this,"x",0),u(this,"y",0),u(this,"radius",0),u(this,"startAngle",0),u(this,"endAngle",0),u(this,"anticlockwise",!0)}genPath(e,t){var{x:r=0,y:n=0,radius:i,startAngle:a,endAngle:o,anticlockwise:h}=this,{origin:f}=t;e.beginPath(),a=a||0,o=o||2*Math.PI,r=r+f.x,n=n+f.y,e.arc(r,n,i,a,o,h),this.pathBox=new S(r-i,n-i,r+i,n+i),e.closePath()}updatePathBox(e,t){throw new Error("Method not implemented.")}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{x:t,y:r,radius:n,startAngle:i,endAngle:a,anticlockwise:o}=e;d(t,"number"),d(r,"number"),d(n,"number"),d(i,"number"),d(a,"number"),d(o,"boolean")}}fromJSON(e){super.fromJSON(e)}}class ne extends re{constructor(){super(...arguments);u(this,"type","path"),u(this,"ATTRIBUTE_NAMES",["path"]),u(this,"path","")}genPath(e){}updatePathBox(e,t){throw new Error("Method not implemented.")}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{path:t}=e;d(t,"string")}}fromJSON(e){super.fromJSON(e)}}class _e extends re{constructor(){super(...arguments);u(this,"type","polygon"),u(this,"ATTRIBUTE_NAMES",["centerX","centerY","radius","sides","startAngle"]),u(this,"centerX",0),u(this,"centerY",0),u(this,"radius",0),u(this,"sides",0),u(this,"startAngle",0)}genPath(e,t){var r=this.getPoints(t.origin);e.beginPath(),e.moveTo(r[0].x,r[0].y);for(var n=1;n<this.sides;++n)e.lineTo(r[n].x,r[n].y);e.closePath()}getPoints(e){var{startAngle:t,centerX:r,centerY:n,sides:i,radius:a}=this,o=[],h=t||0;r=e.x+r,n=e.y+n;for(var f=0;f<i;++f)o.push(new v(r+a*Math.sin(h),r-a*Math.cos(h))),h+=2*Math.PI/i;return this.pathBox=new S(r-a,n-a,2*a,2*a),o}updatePathBox(e,t){throw new Error("Method not implemented.")}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{radius:t,startAngle:r,centerX:n,centerY:i,sides:a}=e;d(n,"number"),d(i,"number"),d(t,"number"),d(r,"number"),d(a,"number")}}fromJSON(e){super.fromJSON(e)}}function Ue(s){switch(s.type){case"rect":return Re.createObj(Re,s);case"arc":return Fe.createObj(Fe,s);case"ellipse":return Me.createObj(Me,s);case"path":return ne.createObj(ne,s);case"polygon":return _e.createObj(_e,s);default:M(s)}}function ut(s){if(s!==void 0)switch(s.type){case"rect":return Re.assertJsonTrue(s);case"arc":return Fe.assertJsonTrue(s);case"ellipse":return Me.assertJsonTrue(s);case"path":return ne.assertJsonTrue(s);case"polygon":return _e.assertJsonTrue(s);default:M(s)}}class dt extends L{constructor(){super(...arguments);u(this,"type","attr_clip"),u(this,"ATTRIBUTE_NAMES",["d_path"]),u(this,"path",void 0),u(this,"d_path",void 0)}takeEffect(e,t){if(!!this.path){var{origin:r,fillRule:n}=t;this.path.genPath(e,{origin:r});var{path:i}=this;if(i instanceof ne){var a=new Path2D(i.path);n==="evenodd"?e.clip(a,n):e.clip(a)}else n==="evenodd"?e.clip(n):e.clip()}}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{d_path:t}=e;ut(t)}}fromJSON(e){super.fromJSON(e);var{d_path:t}=e;t&&(this.path===void 0?this.path=Ue(t):t.type===this.path.type?this.path.fromJSON(t):this.path=Ue(t))}}class q{constructor(){u(this,"assetMap",new Map)}get allAsset(){var e=[];for(var t of this.assetMap.values())e.push(t);return e}getAsset(e){var t=this.assetMap.get(e.data);return t||(t=ir(e)),t}addAsset(e){this.assetMap.set(e.data,e)}async loadAllAsset(){return Promise.allSettled(this.allAsset.map(e=>e.load()))}static getInstance(){return q._instance||(q._instance=new q),q._instance}}u(q,"_instance",void 0);var ie=q.getInstance();class nr extends Oe{constructor(){super(...arguments);u(this,"ASSET_ATTRIBUTE",["data"]),u(this,"data","")}assertAssetUniq(){if(ie.assetMap.has(this.data))throw new Error("\u8D44\u6E90\u91CD\u590D\u521B\u5EFA")}static assertJsonTrue(e){if(e!==void 0){var{data:t}=e;super.assertJsonTrue(e),d(t,"string")}}fromJSON(e){super.fromJSON(e),this.assertAssetUniq(),ie.addAsset(this)}}class Ye extends nr{constructor(){super(...arguments);u(this,"type","asset_image"),u(this,"ATTRIBUTE_NAMES",[...this.ASSET_ATTRIBUTE]),u(this,"element",null)}async load(){var{data:e}=this;if(!this.element){var t=await new Promise((r,n)=>be(e,r,n));this.element=t}}static assertJsonTrue(e){e!==void 0&&super.assertJsonTrue(e)}fromJSON(e){super.fromJSON(e)}}function ir(s){switch(s.type){case"asset_image":case"asset_font":var e=new Ye;return e.fromJSON(s),e;default:M(s)}}class F extends L{constructor(){super(...arguments);u(this,"type","attr_pattern"),u(this,"ATTRIBUTE_NAMES",["asset","repetition","transform"]),u(this,"repetition","repeat"),u(this,"transform",{}),u(this,"asset",void 0)}genPattern(e){var{repetition:t,transform:r,asset:n}=this;if(!n||!n.element)throw new Error("\u6CA1\u6709\u56FE\u7247\u8D44\u6E90\u586B\u5145");var i=e.createPattern(n.element,t!=null?t:null);return i==null||i.setTransform(r),i}static isPattern(e){return e.type==="attr_pattern"}static isPatternData(e){return e.type==="attr_pattern"}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{asset:t,repetition:r,transform:n}=e;Ye.assertJsonTrue(t),d(r,"string"),d(n,"array")}}fromJSON(e){var{asset:t,transform:r}=e;super.fromJSON(e),t!==void 0&&(this.asset=ie.getAsset(t)),r&&(this.transform=r)}}u(F,"repetition",["repeat","repeat-x","repeat-y","no-repeat"]);class U extends L{constructor(){super(...arguments);u(this,"type","attr_gradient"),u(this,"ATTRIBUTE_NAMES",["gradientShape","gradientColors"]),u(this,"gradientColors",[]),u(this,"gradientShape",[0,0,0,0])}genGradient(e){var{gradientShape:t,gradientColors:r}=this,n;t.length===4?n=e.createLinearGradient(...t):n=e.createRadialGradient(...t);for(var i of r)n.addColorStop(...i);return n}static isGradient(e){return e.type==="attr_gradient"}static isGradientData(e){return e.type==="attr_gradient"}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{gradientShape:t,gradientColors:r}=e;d(t,"array"),t&&Ne(t.length===4||t.length===6,"gradientShape \u6570\u7EC4\u4E0D\u7B26\u5408\u89C4\u8303"),d(r,"array")}}fromJSON(e){super.fromJSON(e);var{gradientColors:t,gradientShape:r}=e;t&&(this.gradientColors=t),r&&(this.gradientShape=r)}}class Q extends L{constructor(){super(...arguments);u(this,"type","attr_stroke_styles"),u(this,"ATTRIBUTE_NAMES",["lineDash","lineDashOffset","lineCap","lineJoin","miterLimit","lineWidth"]),u(this,"lineWidth",2),u(this,"lineDash",[]),u(this,"lineDashOffset",0),u(this,"lineCap","butt"),u(this,"lineJoin","bevel"),u(this,"miterLimit",0)}takeEffect(e){super.takeEffect(e),this.lineDash!==void 0&&this.setLineDash(e,this.lineDash)}setLineDash(e,t){!t||t.length===0||e.setLineDash(t)}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{lineDash:t,lineDashOffset:r,lineCap:n,lineJoin:i,miterLimit:a,lineWidth:o}=e;d(t,"array"),d(r,"number"),A(n,Q.lineCap),A(i,Q.lineJoin),d(a,"number"),d(o,"number")}}fromJSON(e){super.fromJSON(e);var{lineDash:t}=e;t&&(this.lineDash=t)}}u(Q,"lineJoin",["bevel","miter","round"]);u(Q,"lineCap",["butt","round","square"]);class ft extends L{constructor(){super(...arguments);u(this,"type","attr_shadow"),u(this,"ATTRIBUTE_NAMES",["shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY"]),u(this,"shadowBlur",0),u(this,"shadowColor","#ffffff00"),u(this,"shadowOffsetX",0),u(this,"shadowOffsetY",0)}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{shadowBlur:t,shadowColor:r,shadowOffsetX:n,shadowOffsetY:i}=e;d(t,"number"),d(r,"string"),d(n,"number"),d(i,"number")}}fromJSON(e){super.fromJSON(e)}}class Z extends L{constructor(){super(...arguments);u(this,"type","attr_font"),u(this,"ATTRIBUTE_NAMES",["fontFamily","fontStyle","fontVariant","fontWeight","fontSize","lineHeight"]),u(this,"fontFamily","sans-serif"),u(this,"fontSize",40),u(this,"fontStyle","normal"),u(this,"fontVariant","normal"),u(this,"fontWeight","normal"),u(this,"lineHeight",1.16)}genFontValue(){var{fontSize:e,fontFamily:t,fontStyle:r,fontVariant:n,fontWeight:i,lineHeight:a}=this;return"".concat(r," ").concat(n," ").concat(i," ").concat(e,"px").concat(a?"/".concat(a):""," ").concat(t)}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{fontFamily:t,fontStyle:r,fontVariant:n,fontWeight:i,fontSize:a,lineHeight:o}=e;d(t,"string"),d(a,"number"),d(o,"number"),d(n,"string"),A(r,Z.fontStyle),A(i,Z.fontWeight)}}fromJSON(e){super.fromJSON(e)}}u(Z,"fontStyle",["normal","italic","oblique"]);u(Z,"fontWeight",["normal","bold","lighter","bolder"]);class Y extends Oe{constructor(){super(...arguments);u(this,"renderParam",void 0),u(this,"fill","#ffffff00"),u(this,"stroke","#ffffff00"),u(this,"strokeParam",new Q),u(this,"fillRule","evenodd"),u(this,"shadow",new ft),u(this,"rotate",new Ie),u(this,"coordStroke",""),u(this,"filter",""),u(this,"origin",new rr),u(this,"clip",new dt),u(this,"elementBox",new S),u(this,"visible",!0)}disappear(){this.visible=!1}appear(){this.visible=!0}setShadow(e){var t;(t=this.shadow)===null||t===void 0||t.takeEffect(e)}setRotate(e){this.rotate.takeEffect(e)}renderBefore(e){this.setRotate(e)}renderCoord(e){var{coordStroke:t,origin:r}=this,{x:n,y:i}=r;t&&(e.beginPath(),e.moveTo(n+20,i),e.lineTo(n,i),e.lineTo(n,20+i),e.strokeStyle=t,e.stroke())}renderAfter(e){this.countElementBox(e),this.rotate.elementBox=this.elementBox,this.renderCoord(e)}setContextParam(e){this.setClip(e),this.setShadow(e),this.setFilter(e),this.setFill(e),this.setStroke(e)}setStroke(e){var{stroke:t,strokeParam:r}=this;!t||(r==null?void 0:r.lineWidth)===0||(typeof t=="string"?e.strokeStyle=t:U.isGradient(t)?e.strokeStyle=t.genGradient(e):F.isPattern(t)&&(e.strokeStyle=t.genPattern(e)||""),this.strokeParam.takeEffect(e))}setFill(e){var{fill:t}=this;!t||(typeof t=="string"?e.fillStyle=t:U.isGradient(t)?e.fillStyle=t.genGradient(e):F.isPattern(t)&&(e.fillStyle=t.genPattern(e)||""))}setFilter(e){var{filter:t}=this;t&&(e.filter=t)}setClip(e){var t,{fillRule:r,origin:n}=this;(t=this.clip)===null||t===void 0||t.takeEffect(e,{fillRule:r,origin:n})}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{strokeParam:t,shadow:r,rotate:n,fill:i,stroke:a,clip:o,origin:h,fillRule:f,filter:g}=e;d(h==null?void 0:h.x,"number"),d(h==null?void 0:h.y,"number"),!!i&&typeof i!="string"&&(i.gradientShape?U.assertJsonTrue(i):i.asset!==void 0&&F.assertJsonTrue(i)),!!a&&typeof a!="string"&&(a.gradientShape?U.assertJsonTrue(a):a.asset!==void 0&&F.assertJsonTrue(a)),Ie.assertJsonTrue(n),dt.assertJsonTrue(o),A(f,Y.fillRule),Q.assertJsonTrue(t),ft.assertJsonTrue(r),d(g,"string")}}fromJSON(e){super.fromJSON(e);var{strokeParam:t,shadow:r,rotate:n,fill:i,stroke:a,clip:o}=e;e.origin&&this.origin.fromJSON(e.origin),!!i&&typeof i!="string"&&(U.isGradientData(i)&&(U.isGradient(this.fill)?this.fill.fromJSON(i):(this.fill=new U,this.fill.fromJSON(i))),F.isPatternData(i)&&(F.isPattern(this.fill)?this.fill.fromJSON(i):(this.fill=new F,this.fill.fromJSON(i)))),!!a&&typeof a!="string"&&(U.isGradientData(a)&&(U.isGradient(this.stroke)?this.stroke.fromJSON(a):(this.stroke=new U,this.stroke.fromJSON(a))),F.isPatternData(a)&&(F.isPattern(this.stroke)?this.stroke.fromJSON(a):(this.stroke=new F,this.stroke.fromJSON(a)))),t&&this.strokeParam.fromJSON(t),r&&this.shadow.fromJSON(r),n&&this.rotate.fromJSON(n),o&&this.clip.fromJSON(o)}}u(Y,"ELEMENT_ATTRIBUTES",["fill","stroke","fillRule","strokeParam","rotate","origin","shadow","filter","clip"]);u(Y,"fillRule",["evenodd","nonzero"]);class X extends Y{constructor(){super();u(this,"ATTRIBUTE_NAMES",["d_path"]),u(this,"type","shape"),u(this,"d_path",void 0),u(this,"path",void 0),this.ATTRIBUTE_NAMES.push(...Y.ELEMENT_ATTRIBUTES)}render(e,t){!this.path||(this.renderParam=t,e.save(),this.renderBefore(e),this.renderFillStroke(e),this.renderAfter(e),e.restore())}renderBefore(e){var{origin:t}=this;!this.path||(super.renderBefore(e),this.path.takeEffect(e,{origin:t}))}countElementBox(e){!this.path||(this.elementBox=this.path.pathBox)}updateElementBox(e){if(!!this.path){var{origin:t}=this;this.path.updatePathBox(e,{origin:t})}}renderFillStroke(e){this.setContextParam(e),this.renderFill(e),this.renderStroke(e)}renderStroke(e){var{path:t}=this;t instanceof ne?e.stroke(new Path2D(t.path)):e.stroke()}renderFill(e){var{path:t}=this;if(t instanceof ne){var r=new Path2D(t.path);this.fillRule==="evenodd"?e.fill(r,"evenodd"):e.fill(r)}else this.fillRule==="evenodd"?e.fill("evenodd"):e.fill()}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{d_path:t}=e;ut(t)}}fromJSON(e){super.fromJSON(e);var{d_path:t}=e;t&&(this.path?this.path.fromJSON(t):this.path=Ue(t))}}class H extends Y{constructor(){super();u(this,"type","text"),u(this,"ATTRIBUTE_NAMES",["font","text","textAlign","textBaseline","direction","border","background"]),u(this,"textBox",new te),u(this,"font",new Z),u(this,"text",""),u(this,"border","#ffffff00"),u(this,"background","#ffffff00"),u(this,"textAlign","left"),u(this,"textBaseline","top"),u(this,"direction","inherit"),this.ATTRIBUTE_NAMES.push(...Y.ELEMENT_ATTRIBUTES)}setTextStyles(e){var{font:t,textBaseline:r,textAlign:n,direction:i}=this;e.textBaseline=r,e.textAlign=n,typeof t=="string"?e.font=t:e.font=t.genFontValue(),e.direction=i}renderBefore(e){super.renderBefore(e),this.setContextParam(e),this.setTextStyles(e)}renderBorderAndBackground(e){var{textBox:t,border:r,background:n}=this;if(!(!t||!r&&!n)){var{boxX:i,boxY:a,boxWidth:o,boxHeight:h}=t;e.save();var f={type:"shape",d_path:{type:"rect",width:o,height:h,x:i,y:a},stroke:r||"#ffffff00",fill:n||"#ffffff00",strokeParam:{lineWidth:1,lineCap:"square",lineJoin:"round",lineDashOffset:0,lineDash:[]}};X.createObj(X,f).render(e),e.restore()}}countElementBox(e){this.elementBox=this.textBox}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{font:t,text:r,textAlign:n,textBaseline:i,direction:a,border:o,background:h}=e;Z.assertJsonTrue(t),d(r,"string"),d(h,"string"),d(o,"string"),A(i,H.textBaseline),A(n,H.textAlign),A(a,H.direction)}}}u(H,"textAlign",["center","end","left","right","start"]);u(H,"textBaseline",["alphabetic","bottom","hanging","ideographic","middle","top"]);u(H,"direction",["inherit","ltr","rtl"]);class ct extends H{constructor(){super(...arguments);u(this,"type","text"),u(this,"ATTRIBUTE_NAMES",[...this.ATTRIBUTE_NAMES])}updateElementBox(e){throw new Error("Method not implemented.")}countTextBox(e){var t=e.measureText(this.text);this.textBox=de(t,this.origin.toPoint(),this.font.fontSize,this.text)}render(e){!this.text||(e.save(),this.renderBefore(e),this.countTextBox(e),this.renderBorderAndBackground(e),this.renderText(e),this.renderAfter(e),e.restore())}renderText(e){e.strokeText(this.text,this.origin.x,this.origin.y),e.fillText(this.text,this.origin.x,this.origin.y)}static assertJsonTrue(e){e!==void 0&&super.assertJsonTrue(e)}fromJSON(e){super.fromJSON(e);var{font:t}=e;t&&this.font.fromJSON(t)}}class Xe extends H{constructor(){super(...arguments);u(this,"ATTRIBUTE_NAMES",["width","height",...this.ATTRIBUTE_NAMES]),u(this,"type","paragraph"),u(this,"width",void 0),u(this,"height",void 0),u(this,"textLineBox",[]),u(this,"tempBox",void 0)}get textLine(){return ke(this.text)}render(e){if(!!this.text){if(e.save(),this.renderBefore(e),this.updateText(e)){e.restore(),this.render(e);return}this.countTextBox(e),this.renderBorderAndBackground(e),this.renderText(e),this.renderAfter(e),e.restore()}}updateText(e){var{textLine:t,text:r}=this;return ht(t,e,this.width),this.text=t.join(""),r!==this.text}renderText(e){for(var{textLine:t,textLineBox:r}=this,n=0;n<r.length;n++){var i=t[n];if(!i)return;var a=r[n],{x:o,y:h}=a;e.strokeText(i,o,h),e.fillText(i,o,h)}}countTextBox(e){for(var{textLine:t,origin:r,textLineBox:n}=this,{x:i,y:a}=r,o=0;o<t.length;o++){var h=e.measureText(t[o]),f=de(h,new v(i,a),this.font.fontSize,t[o]);n[o]=f,a+=f.boxHeight}this.textBox=ot(n),this.textBox.boxHeight>this.height&&(this.height=this.textBox.boxHeight)}updateElementBox(e){var{boxX:t,boxY:r,boxWidth:n,boxHeight:i}=e,{origin:a}=this;t&&(a.x=t),r&&(a.y=r),n&&(this.width=n),i&&(this.height=i)}countElementBox(e){super.countElementBox(e);var{elementBox:t,width:r,height:n}=this;t.boxWidth=r,t.boxHeight=n}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{width:t,height:r}=e;d(t,"number"),d(r,"number")}}fromJSON(e){super.fromJSON(e);var{font:t}=e;t&&this.font.fromJSON(t)}}class K extends Y{constructor(){super();u(this,"type","image"),u(this,"ATTRIBUTE_NAMES",["asset","width","height","imageSmoothing","imageSmoothingQuality"]),u(this,"asset",void 0),u(this,"width",0),u(this,"height",0),u(this,"imageSmoothing",!0),u(this,"imageSmoothingQuality","medium"),this.ATTRIBUTE_NAMES.push(...Y.ELEMENT_ATTRIBUTES)}setImageSmoothing(e){e.imageSmoothingEnabled=this.imageSmoothing,e.imageSmoothingQuality=this.imageSmoothingQuality}render(e){var{width:t,height:r,asset:n}=this;if(!n||!n.element)throw new Error("\u6CA1\u6709\u56FE\u7247\u8D44\u6E90\u586B\u5145");!n||!n.element||!t||!r||(e.save(),this.renderBefore(e),this.renderImage(e,n),this.renderAfter(e),e.restore())}renderBefore(e){super.renderBefore(e),this.setImageSmoothing(e),this.setContextParam(e),this.setImageSmoothing(e)}renderImage(e,t){var{x:r,y:n}=this.origin,{width:i,height:a}=this;e.drawImage(t.element,r,n,i,a)}updateElementBox(e){var{boxX:t,boxY:r,boxWidth:n,boxHeight:i}=e,{origin:a}=this;t&&(a.x=t),r&&(a.y=r),n&&(this.width=n),i&&(this.height=i)}countElementBox(e){var{elementBox:t,width:r,height:n,origin:i}=this;t.boxX=i.x,t.boxY=i.y,t.boxWidth=r,t.boxHeight=n}static assertJsonTrue(e){if(e!==void 0){super.assertJsonTrue(e);var{asset:t,width:r,height:n,imageSmoothing:i,imageSmoothingQuality:a}=e;Ye.assertJsonTrue(t),d(r,"number"),d(n,"number"),d(i,"boolean"),A(a,K.imageSmoothingQuality)}}fromJSON(e){var{asset:t}=e;super.fromJSON(e),t!==void 0&&(this.asset=ie.getAsset(t))}}u(K,"imageSmoothingQuality",["high","low","medium"]);function sr(s){switch(s.type){case"shape":return X.createObj(X,s);case"image":return K.createObj(K,s);case"text":return ct.createObj(ct,s);case"paragraph":return Xe.createObj(Xe,s);default:M(s)}}function Te(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function D(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}class _{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;D(this,"x",void 0),D(this,"y",void 0),this.x=e,this.y=t}clone(){return new _(this.x,this.y)}static Zero(){return new _(0,0)}point_add(e){var{x:t,y:r}=this;return new _(t+e.x,r+e.y)}countEndPointByRotate(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_.Zero(),t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,{x:r,y:n}=this,[i,a]=[e.x,e.y],[o,h]=[r-i,n-a],f=o*Math.cos(t)-h*Math.sin(t),g=o*Math.sin(t)+h*Math.cos(t);return new _(f+i,g+a)}rotatePointOnZero(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,{x:t,y:r}=this;return new _(t*Math.cos(e)-r*Math.sin(e),t*Math.sin(e)+r*Math.cos(e))}transformPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[1,0,0,0,1,0],{x:t,y:r}=this;return new _(e[0]*t+e[2]*r+e[4],e[1]*t+e[3]*r+e[5])}translatePoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,{x:r,y:n}=this;return new _(r+e,n+t)}scalePoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,{x:r,y:n}=this;return new _(r*e,n*t)}countPointBaseTransform(e,t){return e.transFormPoint(this,t)}countPointBaseRotate(e){return e.rotatePoint(this)}}function ar(s){try{return JSON.parse(JSON.stringify(s))}catch{return console.error(s,"\u4E0D\u662F\u4E00\u4E2AJSON\u6570\u636E"),{}}}function We(s){var e=!1;return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e||(requestAnimationFrame(()=>{e=!1,s(...r)}),e=!0)}}class or{set height(e){this._height=e,this.canvas.setAttribute("height","".concat(e))}get height(){return this._height}set width(e){this._width=e,this.canvas.setAttribute("width","".concat(e))}get width(){return this._width}toBase64(){return this.canvas.toDataURL("image/png")}constructor(e){D(this,"canvas",void 0),D(this,"ctx",void 0),D(this,"isInCanvas",!1),D(this,"_height",150),D(this,"_width",300),D(this,"baseOnPointerup",We(a=>this.onPointerup(a))),D(this,"baseOnPointerdown",We(a=>this.onPointerdown(a))),D(this,"baseOnPointermove",We(a=>this.onPointermove(a))),D(this,"lastClickTime",0),D(this,"dblclickDelay",300),D(this,"documentOnPointermove",a=>{a.stopPropagation(),a.preventDefault();var o=this.dom2CanvasPoint(a.x,a.y);(o.x<=0||o.y<=0)&&(this.isInCanvas=!1,this.onPointerup(a))});var{width:t,height:r,canvas:n,dblclickDelay:i}=e;if(n?this.canvas=n:this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("\u6CA1\u6709 ctx");t?this.width=t:this._width=Number(this.canvas.getAttribute("width")),r?this.height=r:this._height=Number(this.canvas.getAttribute("height")),i&&(this.dblclickDelay=i),this.canvas.addEventListener("pointerdown",this.baseOnPointerdown),this.canvas.addEventListener("pointermove",this.baseOnPointermove),this.canvas.addEventListener("pointerup",this.baseOnPointerup),document.addEventListener("pointermove",this.documentOnPointermove)}destroy(){var{canvas:e}=this;e.removeEventListener("pointerdown",this.baseOnPointerdown),e.removeEventListener("pointermove",this.baseOnPointermove),e.removeEventListener("pointerup",this.baseOnPointerup),document.removeEventListener("pointermove",this.documentOnPointermove)}cancelDblclickEffect(){this.lastClickTime=0}dblclickCallback(e){}onPointerdown(e){e.stopPropagation(),e.preventDefault(),this.isInCanvas=!0;var t=Date.now();t-this.lastClickTime<this.dblclickDelay&&this.dblclickCallback(e),this.lastClickTime=t}onPointermove(e){e.stopPropagation(),e.preventDefault()}onPointerup(e){e.stopPropagation(),e.preventDefault()}dom2CanvasPoint(e,t){var{canvas:r,width:n,height:i}=this,{width:a,height:o,left:h,top:f}=r.getBoundingClientRect(),g=(e-h)/a*n,c=(t-f)/o*i;return new _(g,c)}clear(){var{ctx:e}=this;e.clearRect(0,0,this.width,this.height)}clearRect(e,t,r,n){this.ctx.clearRect(e,t,r,n)}fillRect(e,t,r,n){this.ctx.fillRect(e,t,r,n)}strokeRect(e,t,r,n){this.ctx.strokeRect(e,t,r,n)}setGlobalAlpha(e){this.ctx.globalAlpha=e}setGlobalCompositeOperation(e){this.ctx.globalCompositeOperation=e}setBackground(e){var{ctx:t,width:r,height:n}=this;t.save(),t.fillStyle=e,this.fillRect(0,0,r,n),t.restore()}onPoint(e){}drawPoint(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 0, 255, 0.2)",n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,{ctx:i}=this;i.save(),i.fillStyle=r,i.fillRect(e-n/2,t-n/2,n,n),i.restore()}drawLine(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 0, 255, 0.2)",n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"orange",{ctx:i}=this;i.save(),i.strokeStyle=r,i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke(),this.drawPoint(e.x,e.y,n),i.restore()}}class gt extends or{constructor(e){super(e);Te(this,"json",void 0),Te(this,"layersData",[]),Te(this,"elements",[]),Te(this,"dpr",1),this.json=e;var{layers:t,dpr:r}=e;if(!this.ctx)throw new Error("\u7ED8\u5236\u6709\u95EE\u9898");t&&(this.layersData=t),r&&(this.dpr=r),this.setJsonCanvas(),this.loadElements()}setDpr(){var{dpr:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.scale(e,e)}get widthDpr(){return this.width*this.dpr}get heightDpr(){return this.height*this.dpr}setJsonCanvas(){var{canvas:e,width:t,height:r}=this;e.width=this.widthDpr,e.height=this.heightDpr,e.style.width=t+"px",e.style.height=r+"px"}disappearElement(e){e.disappear(),this.render()}appearElement(e){e.appear(),this.render()}clear(){var{ctx:e}=this;e.clearRect(0,0,this.widthDpr,this.heightDpr)}render(){var{ctx:e,elements:t,dpr:r}=this;this.clear(),e.save(),r>0&&r!==1&&this.setDpr();for(var n of t)!n.visible||(e.save(),n.render(e),e.restore());e.restore()}async loadAssets(){return ie.loadAllAsset()}loadElements(){var{layersData:e}=this;for(var t of e){var r=sr(t);this.elements.push(r)}}genData(){var{elements:e,width:t,height:r,dpr:n}=this,i=e.map(a=>a.toJSON());return{width:t,height:r,layers:i,dpr:n||1}}}async function hr(s){var e=new gt(ar(s));return await e.loadAssets(),e.render(),e}const pt={background:"rgba(162, 211, 255, 0.5)",fill:"#606060",stroke:"red",text:`\u4F60h
h\u5566fadfdf\u653E\u5230\u6C99\u53D1\u4E0A\u653E\u5230\u6C99\u53D1
fdfdfa\fdfdf`,font:{fontSize:20},strokeParam:{lineWidth:2},shadow:{shadowBlur:5,shadowOffsetX:5,shadowOffsetY:5,shadowColor:"rgba(0, 0, 0, 0.8)"}},lr={assets:[],layers:[I(E({type:"text"},pt),{origin:{x:100,y:100}}),I(E({type:"paragraph"},pt),{origin:{x:100,y:200},width:100,height:200})],height:500,width:500,dpr:10},ur={assets:[],layers:[{type:"shape",d_path:{type:"polygon",centerY:20,centerX:20,sides:8,radius:50},fill:"yellow",stroke:"red",origin:{x:200,y:200}},{type:"shape",d_path:{type:"rect",rx:5,ry:10,width:100,height:80},origin:{x:300,y:10},fill:"yellow",stroke:"red"},{type:"shape",d_path:{type:"arc",x:200,y:200,radius:50},origin:{x:100,y:100},fill:"yellow"},{type:"shape",d_path:{type:"ellipse",radiusX:50,radiusY:100},origin:{x:50,y:300},fill:"red"},{type:"shape",d_path:{type:"path",path:"m 75.8672,80.4954 c -0.6572,-0.0938 -2.252,-0.4688 -2.627,-0.375 -1.0313,0.1875 0.375,1.501 -0.1875,1.876 -0.4688,0.1875 -1.0313,-0.0938 -1.501,0.0938 -0.1875,0.0938 0.0938,0.4688 -0.0938,0.6572 -0.9375,0.75 -2.4385,0.8438 -3.377,1.6875 -1.125,1.0322 2.0635,3.6582 0.6572,4.6904 -3.2832,2.3447 -1.2197,-1.5947 -3.377,1.501 -0.2813,0.375 0.8438,0.4688 1.0313,0.9375 0.1875,0.376 -0.9375,0.2822 -0.9375,0.6572 0,0.1875 0.9375,1.4072 0.5625,1.876 -1.0313,1.0313 -2.5322,-0.5635 -3.4707,-0.5635 -1.4063,0 1.3135,1.3135 -1.0313,0.6572 -0.6572,-0.1875 -1.501,-1.2197 -1.7822,-1.7822 -0.1875,-0.1875 -0.376,-0.751 -0.4697,-0.5625 -0.375,0.5625 -0.2813,1.2188 -0.6563,1.6875 -1.2188,1.5947 -2.9082,0 -4.3145,0.4697 -0.1875,0.0938 0.1875,0.4688 0,0.6563 -0.8447,0.4688 -2.5332,0.375 -3.377,0 0,0 0,-0.0938 0.0938,-0.0938 0.4688,-0.4688 1.0313,-0.9375 1.2197,-1.4072 3.2822,0.1875 -0.4697,-2.0635 -1.4072,-2.626 -0.6563,-0.375 0.375,-1.5947 0.1875,-2.0635 -0.1875,-0.4697 -1.6885,0.8438 -1.3135,-0.376 0.2813,-0.8438 2.0635,-1.5938 1.4072,-2.1572 -0.4688,-0.375 -2.627,-0.1875 -2.4385,-1.3125 0.1875,-1.501 2.5322,-1.126 2.7197,-3.002 -0.0938,0 -0.0938,0 -0.1875,0 0.5625,0.0938 1.126,0.1875 1.7822,0.2813 0.75,0.0938 1.501,0.6563 2.251,0.75 0.751,0.0938 1.501,-0.4688 2.252,-0.375 0.4688,0.0938 0.75,0.751 1.2188,0.751 0.1875,0.0938 0.0938,-0.4697 0.2813,-0.5635 0.4697,-0.4688 1.2197,-0.6563 1.6885,-1.2188 0.376,-0.2822 0.0938,-0.9385 0.376,-1.2197 1.7813,-1.4072 3.6582,0.375 5.3457,-0.375 0.5635,-0.2813 0.6572,-1.126 1.2197,-1.3135 0.0938,-0.0938 3.1895,0.375 3.2832,0.2813 0.2813,-0.0938 -0.2813,-0.4688 -0.375,-0.75 -0.2813,-1.501 0.8438,-1.876 2.251,-1.876 0.3752,0 1.1262,2.9072 3.0959,4.502 l 0,0 z"},stroke:"red"}],height:500,width:500};function se(s){return"/canvas-2d/"+s}const dr={layers:[{type:"image",origin:{x:100,y:100},width:200,height:200,fill:"yellow",stroke:"red",asset:{type:"asset_image",data:se("images/logo.png")}}],dpr:3,height:500,width:500},fr={layers:[{type:"text",origin:{x:100,y:100},fill:{type:"attr_gradient",gradientShape:[0,0,500,500],gradientColors:[[0,"blue"],[.25,"blue"],[.5,"white"],[.75,"red"],[1,"yellow"]]},stroke:{type:"attr_pattern",asset:{data:se("images/cloth.png"),type:"asset_image"},repetition:"repeat"},text:"\u4F60\u597DfillStyle.genGradient(ctx)",font:{fontFamily:"sans-serif",fontSize:100},strokeParam:{lineWidth:10}},{type:"text",origin:{x:100,y:300},fill:{type:"attr_pattern",asset:{data:se("images/redball.png"),type:"asset_image"},repetition:"repeat"},stroke:{type:"attr_gradient",gradientShape:[100,100,500,500],gradientColors:[[0,"yellow"],[.25,"red"],[.5,"blue"],[.75,"red"],[1,"blue"]]},text:"\u4F60\u597DfillStyle.genGradient(ctx)",font:{fontFamily:"sans-serif",fontSize:100},strokeParam:{lineWidth:10}}],height:500,width:500,dpr:10},cr={layers:[{type:"image",origin:{x:100,y:100},width:200,height:200,fill:"yellow",stroke:"red",asset:{type:"asset_image",data:se("images/logo.png")},clip:{d_path:{type:"arc",x:100,y:100,radius:100}}}],dpr:2,height:500,width:500};function gr(s){switch(s){case"text":return lr;case"shape":return ur;case"image":return dr;case"gradient-pattern":return fr;case"clip":return cr;default:M(s)}}function pr(s){const{subModule:e="text"}=s,t=y.exports.useRef(null);return y.exports.useEffect(()=>{hr(gr(e)).then(r=>{t.current.src=r.toBase64()})},[e]),p("img",{ref:t,style:{width:"600px",height:"600px",border:"1px solid red"}})}function w(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function mr(s,e){for(var{x:t,y:r}=e,[n,i]=[0,0];n+1<s.length;n++){var a=s[n][0];if(a.boxY+a.boxHeight>r)break}var o=s[n];if(!o.length)return{caretRow:n,caretColumn:i};for(;i<o.length;i++){var h=s[n][i];if(h.boxX+h.boxWidth>t)return{caretRow:n,caretColumn:i}}return{caretRow:n,caretColumn:n===s.length-1?i:i-1}}function mt(s,e,t){vt(s,{caretRow:e,caretColumn:t});var r=0,[n,i]=[0,0];for(n=0;n<s.length;n++){var a=s[n];for(i=0;i<a.length;i++){if(n===e&&i===t)return r;r++}}return r}function vt(s,e){var t,{caretRow:r,caretColumn:n}=e;if(!yt(s,r,n)&&!((t=s[r])!==null&&t!==void 0&&t[n]))throw new Error("caret \u7684\u5750\u6807\u8D85\u51FA\u7684\u8303\u56F4")}function yt(s,e,t){var r,n=s.length-1,i=(((r=s[n])===null||r===void 0?void 0:r.length)||0)-1;return e===n&&t===i+1}function xt(s,e,t,r){var n;if(vt(s,{caretRow:e,caretColumn:t}),!yt(s,e,t))return new v(s[e][t].boxX,s[e][t].boxY);var i=(n=s[e])===null||n===void 0?void 0:n[t-1];if(i)return new v(i.boxX+i.boxWidth,i.boxY);var a,o;return new v(r.x,((a=s[e-1])===null||a===void 0?void 0:a[0].boxY)+((o=s[e-1])===null||o===void 0?void 0:o[0].boxHeight)||r.y)}function bt(s,e){var t=0,[r,n]=[0,0];for(r=0;r<s.length;r++){var i=s[r];for(n=0;n<i.length;n++){if(t===e)return{caretRow:r,caretColumn:n};t++}}return Ne(e===t,"\u7D22\u5F15\u503C\u6709\u95EE\u9898"),{caretRow:r-1,caretColumn:n}}function wt(s,e,t){var r=mr(s,e),n=mt(s,r.caretRow,r.caretColumn),i=xt(s,r.caretRow,r.caretColumn,t);return{coord:r,position:i,index:n}}var vr=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];class yr{constructor(e){w(this,"hiddenInput",document.createElement("textarea")),w(this,"onNewValueCallBack",void 0),w(this,"onKeydownCallBack",void 0),this.setStyle(),this.hiddenInput.value=e}isCtrlValue(e){return vr.includes(e)}onNewValue(e){this.onNewValueCallBack=ue(()=>e(this.hiddenInput.value)),this.hiddenInput.addEventListener("input",this.onNewValueCallBack)}onKeydown(e){this.onKeydownCallBack=ue(t=>{e(t.code)}),this.hiddenInput.addEventListener("keydown",this.onKeydownCallBack)}setStyle(){var{hiddenInput:e}=this;e.style.position="absolute",e.style.opacity="0",e.style.pointerEvents="none",e.style.zIndex="0",e.style.transform="scale(0)"}clearValue(){this.hiddenInput.value=""}focus(){document.body.appendChild(this.hiddenInput),this.hiddenInput.focus()}blur(){this.hiddenInput.blur(),this.clearValue(),document.body.contains(this.hiddenInput)&&(this.hiddenInput.removeEventListener("input",this.onNewValueCallBack),this.hiddenInput.removeEventListener("keydown",this.onKeydownCallBack),document.body.removeChild(this.hiddenInput))}updateInputCaret(e){var{hiddenInput:t}=this;t.selectionStart=e,t.selectionEnd=e}updateInputSelection(e,t){if(e!==t){if(e>t){this.updateInputSelection(t,e);return}var{hiddenInput:r}=this;r.selectionStart=e,r.selectionEnd=t}}}var xr={type:"shape",d_path:{type:"rect",x:0,y:0,width:0,height:0},fill:"red"};class br{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:2;w(this,"x",void 0),w(this,"y",void 0),w(this,"height",void 0),w(this,"width",void 0),w(this,"caretImageData",void 0),w(this,"caretImageX",void 0),w(this,"caretImageY",void 0),w(this,"caretShape",void 0),w(this,"show",!1),w(this,"time",void 0),this.x=e,this.y=t,this.height=r,this.width=n,this.caretShape=X.createObj(X,xr)}showCaret(e){var{x:t,y:r,width:n,height:i,caretShape:a}=this;this.caretImageX=t,this.caretImageY=r,this.caretImageData=e.getImageData(this.caretImageX,this.caretImageY,n,i),a.origin.x=t,a.origin.y=r,a.path.width=n,a.path.height=i,a.render(e)}hideCaret(e){var{caretImageData:t,caretImageX:r,caretImageY:n}=this;t&&e.putImageData(t,r,n)}cancelTwinkle(e){this.hideCaret(e),clearTimeout(this.time)}startTwinkle(e){this.show=!0,this.twinkle(e)}twinkle(e){var{show:t}=this;t?this.hideCaret(e):this.showCaret(e),this.show=!this.show,this.time=setTimeout(()=>{this.twinkle(e)},t?300:700)}clearTime(){this.time&&clearTimeout(this.time),this.time=void 0}update(e){this.hideCaret(e),this.showCaret(e)}clear(e){this.show&&this.hideCaret(e),this.clearTime()}}class wr{constructor(){w(this,"active",!1)}renderSelection(e,t){if(!!this.active)for(var r=0;r<t.length;r++)X.createObj(X,{type:"shape",d_path:t[r],fill:"rgba(162, 211, 255, 0.5)"}).render(e)}showSelection(e,t,r,n){for(var i=0,a=!1,o=[],h=0;h<t.length;h++){var f;if(n===i){this.renderSelection(e,o);return}for(var g=t[h],c=(f=t[h])===null||f===void 0?void 0:f[0],m=0,x=0;x<g.length;x++){if(r===i){var T;a=!0,c=(T=t[h])===null||T===void 0?void 0:T[x],m=0}if(i++,m+=t[h][x].boxWidth,n===i){o.push({type:"rect",x:c.boxX,y:c.boxY,width:m,height:c.boxHeight}),this.renderSelection(e,o);return}}a&&o.push({type:"rect",x:c.boxX,y:c.boxY,width:m,height:c.boxHeight})}}}class Tt extends we{get origin(){var{origin:e}=this.paragraph;return new v(e.x,e.y)}get defaultBoxHeight(){return this.paragraph.font.fontSize}get textLength(){return this.text.length}get text(){return this.paragraph.text}set text(e){this.paragraph.text=e}get textChar(){return jt(this.text)}constructor(e){super(e);w(this,"paragraph",null),w(this,"__debug",!1),w(this,"hiddenInput",void 0),w(this,"caret",void 0),w(this,"selection",void 0),w(this,"lenAfterCaret",0),w(this,"lenBeforeCaretStart",0),w(this,"lenBeforeCaretEnd",0),w(this,"caretTime",void 0),w(this,"textCharBox",[[]]),w(this,"renderCallBack",()=>{}),w(this,"elementBlurCallback",i=>{}),w(this,"onKeydown",i=>{var{lenAfterCaret:a}=this;if(!!this.hiddenInput.isCtrlValue(i)){switch(i){case"ArrowLeft":if(a>=this.textLength)return;this.lenAfterCaret++;break;case"ArrowRight":if(a<=0)return;this.lenAfterCaret--;break;case"ArrowUp":case"ArrowDown":this.onArrowUpDown(i==="ArrowUp"?"ArrowUp":"ArrowDown")}this.render()}}),w(this,"onNewValue",i=>{this.text=i,this.render()});var{paragraph:t,renderCallBack:r,elementBlurCallback:n}=e;t&&this.setParagraph(t),r&&(this.renderCallBack=r),n&&(this.elementBlurCallback=n)}setParagraph(e){e&&(this.paragraph=e),this.caret=new br(this.origin.x,this.origin.y,this.defaultBoxHeight),this.hiddenInput=new yr(this.text),this.selection=new wr,this.hiddenInput.onNewValue(this.onNewValue),this.hiddenInput.onKeydown(this.onKeydown),this.lenAfterCaret=0,this.render()}removeParagraph(){this.cancelCaretTwinkle(),this.hiddenInput.blur(),this.paragraph=null,this.clear()}cancelCaretTwinkle(){clearTimeout(this.caretTime),this.caret.cancelTwinkle(this.ctx)}startCaretTwinkle(){this.cancelCaretTwinkle(),this.caretTime=setTimeout(()=>{this.renderStatic(),this.caret.startTwinkle(this.ctx)},1500)}onPointerdown(e){if(super.onPointerdown(e),!!this.paragraph){var{textCharBox:t,paragraph:r}=this,n=this.dom2CanvasPoint(e.pageX,e.pageY);if(!r.elementBox.isPointInFrame(n,r.rotate)){this.submit(e);return}this.startCaretTwinkle(),this.selection.active=!0;var i=wt(t,n,this.origin);this.lenBeforeCaretStart=i.index,this.lenBeforeCaretEnd=i.index,this.updateLenAfterCaret(i),this.render()}}onPointermove(e){if(super.onPointermove(e),!!this.paragraph){var{textCharBox:t}=this;if(!!this.selection.active){var r=this.dom2CanvasPoint(e.pageX,e.pageY),n=wt(t,r,this.origin);this.lenBeforeCaretEnd=n.index,this.lenBeforeCaretEnd!==this.lenBeforeCaretStart&&(this.cancelCaretTwinkle(),this.renderStatic())}}}onPointerup(e){super.onPointerup(e),!!this.paragraph&&(this.selection.active=!1,this.hiddenInput.focus())}updateLenAfterCaret(e){var{textLength:t}=this,{index:r,coord:n}=e;this.lenAfterCaret=t-r,this.renderCaretByCoord(n.caretRow,n.caretColumn),this.__debug&&console.log("\u5149\u6807\u7684\u70B9\u51FB\u4F4D\u7F6E\u662F",n,r,this.lenAfterCaret,this.textLength-this.lenAfterCaret)}submit(e){this.elementBlurCallback(e),!!this.paragraph&&this.render()}onArrowUpDown(e){var{textLength:t,textCharBox:r,lenAfterCaret:n}=this,i=bt(r,t-n),{caretRow:a,caretColumn:o}=i;if(e==="ArrowDown"){var h;if(a===r.length-1)o=r[a].length-1;else if(r[a].length-1===o){if(a+1===r.length-1){this.lenAfterCaret=0;return}o=r[a+1].length-1,a++}else(h=r[a+1])!==null&&h!==void 0&&h[o]||(o=r[a+1].length-1),a++}else{var f;a===0?o=0:(f=r[a-1])!==null&&f!==void 0&&f[o]?a--:(a--,o=r[a].length-1)}var g=mt(r,a,o);this.lenAfterCaret=t-g}updateCaretByAfterIndex(){var{textLength:e,lenAfterCaret:t,textCharBox:r}=this,n=e-t,i=bt(r,n);this.renderCaretByCoord(i.caretRow,i.caretColumn)}renderCaretByCoord(e,t){var{textCharBox:r,origin:n,textLength:i,lenAfterCaret:a}=this,o=xt(r,e,t,n);this.caret.x=o.x,this.caret.y=o.y,this.caret.showCaret(this.ctx),setTimeout(()=>{this.hiddenInput.updateInputCaret(i-a)}),this.__debug&&this.drawPoint(o.x,o.y)}countTextBox(){var{ctx:e,textChar:t,origin:r,defaultBoxHeight:n}=this;if(!!this.paragraph){var{x:i,y:a}=r,o=[];e.save(),this.paragraph.renderBefore(e);for(var h=0;h<t.length;h++){var f=t[h],g=[];i=r.x;for(var c=Number.MIN_VALUE,m=0;m<f.length;m++){var x=f[m],T=de(e.measureText(x),new v(i,a),n,x);g[m]=T,this.__debug&&this.drawPoint(T.x,T.y),this.__debug&&this.drawPoint(T.boxX,T.boxY,"rgba(0, 0, 255, .3)"),i+=T.boxWidth,c=Math.max(c,T.boxHeight)}a+=c,o[h]=g}this.textCharBox=o,this.__debug&&console.log("\u68C0\u6D4B\u6570\u636E",this.textChar,this.textCharBox),e.restore()}}renderContent(){var{ctx:e,text:t,paragraph:r}=this;if(!!r){r.text=t,r.elementBox.render(e,{stroke:"red",fill:"white"});var n=r.rotate;r.rotate=new Ie,r.render(e),r.rotate=n,this.hiddenInput.hiddenInput.value=this.text}}updateSelection(){var{ctx:e,lenBeforeCaretStart:t,lenBeforeCaretEnd:r,selection:n,textCharBox:i}=this;if(t!==r){var a=t>r?r:t,o=t>r?t:r;this.hiddenInput.updateInputSelection(a,o),n.showSelection(e,i,a,o)}}renderStatic(){this.clear(),this.renderContent(),this.countTextBox(),this.updateSelection()}render(){this.renderStatic(),this.updateCaretByAfterIndex(),this.renderCallBack()}}const St=new Xe;St.fromJSON({text:"123",font:{},origin:{x:10,y:10},fill:"black",width:200,height:200});function Tr(){const s=y.exports.useRef(null);return y.exports.useEffect(()=>{new Tt({canvas:s.current,width:600,height:600,paragraph:St})},[]),p("canvas",{ref:s,style:{width:"600px",height:"600px",border:"1px solid red"}})}const ge=class extends we{constructor(e){super(e);l(this,"p",v.Zero());l(this,"trans",new Qt);this.trans.offsetX=ge.coordWidth,this.trans.offsetY=ge.coordHeight}onPointerdown(e){super.onPointerdown(e);const t=this.dom2CanvasPoint(e.x,e.y);this.p=new v(t.x,t.y),console.log("\u672A\u8F6C\u6362\u524D",this.p),this.render()}render(){const{ctx:e}=this;this.clear(),e.save(),this.setTransform(),this.renderTransPoint(),this.renderCoord(),e.restore()}setTransform(){this.trans.takeEffect(this.ctx)}renderTransPoint(){const{p:e,ctx:t,trans:r}=this,n=e.countPointBaseTransform(r),{scaleX:i,scaleY:a}=r;S.fromPoint(n).render(t,{fill:"red"}),S.fromPoint(n,5/i,5/a).render(t,{fill:"black"}),console.log("\u8F6C\u6362\u540E",n)}renderCoord(){const{ctx:e,trans:t}=this,{coordWidth:r,coordHeight:n,coordInterval:i}=ge;e.beginPath(),e.strokeStyle="red",e.moveTo(-r,0),e.lineTo(r,0);for(let a=-r+i;a<r;a+=i)this.drawPoint(a,0,"blue"),e.strokeText(Math.abs(a)+"",a,10);e.stroke(),e.strokeStyle="black",e.beginPath(),e.moveTo(0,-n),e.lineTo(0,n);for(let a=-n+i;a<n;a+=i)this.drawPoint(0,a,"blue"),e.strokeText(Math.abs(a)+"",-10,a);e.stroke(),this.drawPoint(t.angleCenter.x,t.angleCenter.y,"green")}};let N=ge;l(N,"coordWidth",300),l(N,"coordHeight",300),l(N,"coordInterval",30);const Sr={width:"600px",height:"600px",position:"absolute"};function Er(){const s=y.exports.useRef(null),e=y.exports.useRef(null);y.exports.useEffect(()=>{e.current=new N({canvas:s.current,width:600,height:600})},[]);const t=function(r,n){var a;const i=e.current;n==="angleCenterX"?i.trans.angleCenter.x=r:n==="angleCenterY"?i.trans.angleCenter.y=r:i.trans[n]=r,(a=e.current)==null||a.render()};return C("div",{style:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[p("canvas",{ref:s,style:I(E({},Sr),{outline:"1px solid red",position:"relative"})}),C("div",{style:{width:"90%"},children:[C(xe,{children:[p(R,{span:4,children:"offset\uFF1A"}),p(R,{span:10,children:p($,{defaultValue:N.coordWidth,min:0,max:2*N.coordWidth,onChange:r=>t(r,"offsetX")})}),p(R,{span:10,children:p($,{defaultValue:N.coordHeight,min:0,max:2*N.coordHeight,onChange:r=>t(r,"offsetY")})})]}),C(xe,{children:[p(R,{span:4,children:"angle\uFF1A"}),p(R,{span:10,children:p($,{defaultValue:0,min:0,step:.1,max:3.3,onChange:r=>t(r,"angle")})})]}),C(xe,{children:[p(R,{span:4,children:"angleCenter\uFF1A"}),p(R,{span:10,children:p($,{defaultValue:0,min:-N.coordWidth,max:N.coordWidth,onChange:r=>t(r,"angleCenterX")})}),p(R,{span:10,children:p($,{defaultValue:0,min:-N.coordHeight,max:N.coordHeight,onChange:r=>t(r,"angleCenterY")})})]}),C(xe,{children:[p(R,{span:4,children:"scale\uFF1A"}),p(R,{span:10,children:p($,{defaultValue:1,min:0,step:.1,max:3,onChange:r=>t(r,"scaleX")})}),p(R,{span:10,children:p($,{defaultValue:1,min:0,step:.1,max:3,onChange:r=>t(r,"scaleY")})})]})]})]})}var Br="/canvas-2d/assets/logo.f30d4222.png",Cr="/canvas-2d/assets/qr.96dcca36.png";function Ar(){const s=y.exports.useRef(null);return y.exports.useEffect(()=>{be(Br,e=>{be(Cr,async t=>{const r=Je(t),n=Je(e);tr(n,r,60,60,.5);const i=await er(r);s.current.src=i})})},[]),p("img",{ref:s,style:{width:"600px",height:"600px",border:"1px solid red"}})}class Pr{constructor(e,t){l(this,"controlSize",10);l(this,"boundingBox",new S);l(this,"angleCenterBox",new S(0,0,this.controlSize,this.controlSize));l(this,"angleCenterDragEnable",!1);l(this,"controlPoints",new Array(9).fill(0).map(()=>new S(0,0,this.controlSize,this.controlSize)));l(this,"eleFrame");t&&(this.angleCenterDragEnable=t,this.angleCenterBox.boxX=e.angleCenter.x,this.angleCenterBox.boxY=e.angleCenter.y)}get centerPoint(){return this.angleCenterBox.centerPoint}get rotateControl(){return this.controlPoints[4]}render(e,t){this.eleFrame=t,this.angleCenterDragEnable||(this.angleCenterBox=S.fromPoint(this.eleFrame.centerPoint,this.controlSize,this.controlSize)),this.updateBoundingBox(e),this.updateControlPoints(e)}updateBoundingBox(e){const{boundingBox:t,eleFrame:r,controlSize:n}=this,{boxX:i,boxY:a,boxWidth:o,boxHeight:h}=r;t.boxX=i-n,t.boxY=a-n,t.boxWidth=o+2*n,t.boxHeight=h+2*n,t.render(e,{stroke:"black"})}updateControlPoints(e){const{controlSize:t,controlPoints:r}=this,{boxX:n,boxY:i,boxWidth:a,boxHeight:o}=this.boundingBox,h=a/2,f=o/2;for(let g=0;g<3;g++)for(let c=0;c<3;c++)r[g*3+c].boxX=n+h*g-t/2,r[g*3+c].boxY=i+f*c-t/2;r[4].boxY=r[4].boxY-f-t*2,r.forEach(g=>g.render(e,{fill:"red"})),this.angleCenterBox.render(e,{fill:this.angleCenterDragEnable?"blue":"gray"})}countRotateAngle(e,t){const{x:r,y:n}=this.centerPoint,[i,a]=[e.x,e.y],[o,h]=[t.x,t.y],f=[i-r,a-n],g=[o-r,h-n],c=f[0]*g[1]-f[1]*g[0],m=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2))*Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2)),x=c/m;return Math.asin(x)}}var Et;(function(s){s[s.None=0]="None",s[s.Drag=1]="Drag",s[s.angleCenterDrag=2]="angleCenterDrag",s[s.Rotate=3]="Rotate",s[s.Resize=4]="Resize"})(Et||(Et={}));class Le extends we{constructor(e){super(e);l(this,"controlAction",0);l(this,"firstP",new v(0,0));l(this,"firstPBaseTrans",new v(0,0));l(this,"p",new v(0,0));l(this,"pBaseTrans",new v(0,0));l(this,"controlElement",null);l(this,"resizeIndex",0);l(this,"angleCenterDragEnable",!1);l(this,"renderCallBack",()=>{});l(this,"elementBlurCallback",(e,t)=>{});const{boxElement:t,renderCallBack:r,elementBlurCallback:n,angleCenterDragEnable:i}=e;i&&(this.angleCenterDragEnable=i),r&&(this.renderCallBack=r),n&&(this.elementBlurCallback=n),t&&this.setBoxElement(t)}destroy(){super.destroy(),this.removeBoxElement()}setBoxElement(e){this.controlElement={boxElement:e,controlFrame:new Pr(e.rotate,this.angleCenterDragEnable)},this.init()}removeBoxElement(){this.controlElement=null,this.clear()}dblclickCallback(e){const{controlElement:t}=this;!t||this.elementBlurCallback(e,!0)}onPointerdown(e){super.onPointerdown(e);const{controlElement:t}=this;if(!t)return;const{boxElement:{rotate:r}}=t,n=this.dom2CanvasPoint(e.x,e.y);this.p=n,this.pBaseTrans=n.countPointBaseRotate(r),this.firstP=n,this.firstPBaseTrans=this.pBaseTrans,this.countControlAction(e),this.render()}countControlAction(e){const{pBaseTrans:t,p:r,controlElement:n,angleCenterDragEnable:i}=this;if(!n)return;const{controlFrame:a}=n,{boundingBox:o,rotateControl:h,controlPoints:f,angleCenterBox:g}=a;if(i&&g.isPointInFrame(r)){this.controlAction=2;return}if(h.isPointInFrame(t)){this.controlAction=3;return}for(let c=0;c<f.length;c++)if(f[c].isPointInFrame(t)){this.controlAction=4,this.resizeIndex=c;return}if(o.isPointInFrame(t)){this.controlAction=1;return}this.elementBlurCallback(e,!1)}onPointermove(e){super.onPointermove(e);const{controlAction:t,p:r,controlElement:n,angleCenterDragEnable:i,pBaseTrans:a}=this;if(this.controlAction===0||!n)return;const{controlFrame:o,boxElement:h}=n,{rotate:f,elementBox:g}=h,{boxX:c,boxY:m,boxWidth:x,boxHeight:T}=g,z=this.dom2CanvasPoint(e.x,e.y),Be=z.countPointBaseRotate(f),me=i?Be.x-a.x:z.x-r.x,ve=i?Be.y-a.y:z.y-r.y;if(t===1)h.updateElementBox(I(E({},g),{boxX:c+me,boxY:m+ve}));else if(t===3)f.angle+=o.countRotateAngle(r,z);else if(t===4){const{resizeIndex:ye}=this;let k={};ye%3==0?k=I(E({},k),{boxHeight:T-ve,boxY:m+ve}):ye%3==2&&(k=I(E({},k),{boxHeight:T+ve})),Math.floor(ye/3)===0?k=I(E({},k),{boxX:c+me,boxWidth:x-me}):Math.floor(ye/3)===2&&(k=I(E({},k),{boxWidth:x+me})),(k.boxWidth===void 0||k.boxWidth>0)&&(k.boxHeight===void 0||k.boxHeight>0)&&h.updateElementBox(E(E({},g),k))}else i&&this.controlAction===2&&(o.angleCenterBox.boxX=z.x,o.angleCenterBox.boxY=z.y,f.angleCenter=o.centerPoint.countPointBaseRotate(f));this.render(),this.p=z,this.pBaseTrans=Be}onPointerup(e){super.onPointerup(e),!(this.controlAction===0||!this.controlElement)&&(this.render(),this.controlAction=0)}init(){this.render()}render(){const{ctx:e,controlElement:t}=this;if(!t)return;const{boxElement:r,controlFrame:n}=t;e.save(),this.clear(),r.render(e),r.rotate.takeEffect(e),n.render(e,r.elementBox),this.renderCallBack(),e.restore()}}class kr{constructor(e=!1){l(this,"rotate",new qt);l(this,"elementBox",new S(0,0,100,200));l(this,"updateElementBox",e=>{const{boxX:t,boxY:r,boxWidth:n,boxHeight:i}=e,{elementBox:a}=this;a.boxX=t,a.boxY=r,a.boxWidth=n,a.boxHeight=i,this.angleCenterDragEnable||(this.rotate.angleCenter=a.centerPoint)});l(this,"render",e=>{const{elementBox:t,rotate:r}=this;e.save(),r.takeEffect(e),t.render(e,{fill:"yellow",stroke:"red"}),e.restore()});this.angleCenterDragEnable=e}}function Jr(){const s=y.exports.useRef(null),e=y.exports.useRef(null),t=y.exports.useRef(null);return y.exports.useEffect(()=>{const r=!0;t.current=new kr(r),new Le({canvas:s.current,width:600,height:600,boxElement:t.current,angleCenterDragEnable:r}),new lt({canvas:e.current,width:600,height:600,coordInterval:20,backgroundColor:"white"})},[]),C(Ae,{children:[p("canvas",{ref:e,style:{width:"600px",height:"600px",border:"1px solid red",position:"absolute"}}),p("canvas",{ref:s,style:{width:"600px",height:"600px",border:"1px solid red",position:"absolute"}})]})}function Dr(s){const{subModule:e}=s;switch(e){case"transparent":return p(Ar,{});case"point-transform":return p(Er,{});case"box-transform":return p(Jr,{});default:M(e)}}const Nr={type:"shape",d_path:{type:"ellipse",x:60,y:60,radiusX:40,radiusY:30,startAngle:1},origin:{x:300,y:300},fill:"yellow"};X.createObj(X,Nr);const Or={type:"image",asset:{type:"asset_image",data:se("images/logo.png")},width:200,height:200},Ir=K.createObj(K,Or);function Rr(){const s=y.exports.useRef(null),e=y.exports.useRef(null);return y.exports.useEffect(()=>{ie.loadAllAsset().then(()=>{new Le({canvas:s.current,width:600,height:600,boxElement:Ir}),new lt({canvas:e.current,width:600,height:600,coordInterval:20,backgroundColor:"white"})})},[]),C(Ae,{children:[p("canvas",{ref:e,style:{width:"600px",height:"600px",border:"1px solid red",position:"absolute"}}),p("canvas",{ref:s,style:{width:"600px",height:"600px",border:"1px solid red",position:"absolute"}})]})}class Mr extends gt{constructor(e){const{container:t,width:r,height:n,eleChange:i}=e;super(e);l(this,"dynamicCanvas",document.createElement("canvas"));l(this,"canvasTransform");l(this,"canvasInput");l(this,"isEditor",!1);l(this,"eleChange",()=>{});l(this,"transElementBlurCallback",(e,t)=>{const{canvasTransform:r}=this;if(t){const{boxElement:n}=r.controlElement;if(n.type!=="paragraph")return}this.removeTransCanvas(),this.isDblclick=t,this.cancelDblclickEffect(),this.onPointerdown(e),this.updateElement(null)});l(this,"isDblclick",!1);const{dynamicCanvas:a}=this;i&&(this.eleChange=i),a.setAttribute("width",`${r}`),a.setAttribute("height",`${n}`),this.canvasTransform=new Le({canvas:a,elementBlurCallback:(o,h)=>this.transElementBlurCallback(o,h),renderCallBack:()=>this.eleChange()}),this.canvasInput=new Tt({canvas:a,elementBlurCallback:o=>this.inputCanvasBlurCallback(o),renderCallBack:()=>this.eleChange()}),this.createCanvas(t)}onPointerdown(e){super.onPointerdown(e);const t=this.dom2CanvasPoint(e.x,e.y),{elements:r}=this;for(let n=0;n<r.length;n++){const i=r[n];if(i.elementBox.isPointInFrame(t,i.rotate)){if(this.isDblclick){i.type==="paragraph"&&this.inputCanvasActive(i,e),this.isDblclick=!1;return}this.transformCanvasActive(i,e);return}}}inputCanvasActive(e,t){const{canvasInput:r}=this;r.paragraph||(this.removeTransCanvas(),this.canvasInput.setParagraph(e),this.disappearElement(e),this.updateElement(e))}inputCanvasBlurCallback(e){const{canvasInput:t}=this;!t.paragraph||(this.appearElement(t.paragraph),this.canvasInput.removeParagraph(),this.cancelDblclickEffect(),this.onPointerdown(e),this.updateElement(null))}transformCanvasActive(e,t){const{canvasTransform:r}=this;r.controlElement||(r.setBoxElement(e),this.disappearElement(e),this.updateElement(e),this.canvasTransform.onPointerdown(t))}removeTransCanvas(){const{canvasTransform:e}=this;!e.controlElement||(this.appearElement(e.controlElement.boxElement),e.removeBoxElement())}updateElement(e){e===null?!this.canvasInput.paragraph&&!this.canvasTransform.controlElement&&(this.eleChange(null),this.updateFocusCanvas(!1)):(this.eleChange(e),this.updateFocusCanvas(!0))}update(){const{canvasInput:e,canvasTransform:t}=this;e.paragraph?e.render():t.controlElement?t.render():this.render()}updateFocusCanvas(e=!1){const{dynamicCanvas:t}=this;this.isEditor=e,e?t.style.pointerEvents="auto":t.style.pointerEvents="none"}dblclickCallback(){this.isDblclick=!0}cancelDblclickEffect(){super.cancelDblclickEffect(),this.canvasTransform.cancelDblclickEffect(),this.canvasInput.cancelDblclickEffect()}async createCanvas(e){const{canvas:t,dynamicCanvas:r,width:n,height:i}=this;e.innerHTML="",n&&(r.width=n,e.style.width=n+"px",r.style.width=n+"px"),i&&(r.height=i,e.style.height=i+"px",r.style.height=i+"px"),t.style.position="absolute",r.style.position="absolute",e.style.position="relative",t.style.top="0px",r.style.top="0px",t.style.left="0px",r.style.left="0px",e.style.userSelect="none",e.style.boxSizing="content-box",r.style.pointerEvents="none",e.appendChild(t),e.appendChild(r)}}class He{static assertJsonTrue(e){}fromJSON(e){B(this,e,this.ATTRIBUTE_NAMES)}toJSON(){return it(this,this.ATTRIBUTE_NAMES)}static createObj(e,t){const r=new e;return r.fromJSON(t),r}}class G extends He{takeEffect(e,...t){const r=this.ATTRIBUTE_NAMES;for(const n of r){const i=this[n];i!==void 0&&n in e&&(e[n]=i)}}}class Fr extends G{constructor(){super(...arguments);l(this,"type","attr_origin");l(this,"ATTRIBUTE_NAMES",["x","y"]);l(this,"x",0);l(this,"y",0)}toPoint(){return new v(this.x,this.y)}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{x:t,y:r}=e;d(t,"number"),d(r,"number")}fromJSON(e){super.fromJSON(e)}}class Bt extends G{constructor(){super(...arguments);l(this,"type","attr_rotate");l(this,"ATTRIBUTE_NAMES",["angle"]);l(this,"angle",0);l(this,"elementBox")}get angleCenter(){return this.elementBox?this.elementBox.centerPoint:v.Zero()}takeEffect(e){const{angle:t=0,angleCenter:r}=this,{x:n,y:i}=r;t&&(e.translate(n,i),e.rotate(t),e.translate(-n,-i))}rotatePoint(e){const{angleCenter:t,angle:r}=this;return r&&(e=e.translatePoint(-t.x,-t.y),e=e.rotatePointOnZero(-r),e=e.translatePoint(t.x,t.y)),e}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{angle:t}=e;d(t,"number")}fromJSON(e){super.fromJSON(e)}}class ae extends G{constructor(){super(...arguments);l(this,"pathBox",new S)}takeEffect(e,t){this.genPath(e,t)}}l(ae,"ELEMENT_ATTRIBUTES",[]);class Ge extends ae{constructor(){super(...arguments);l(this,"type","rect");l(this,"ATTRIBUTE_NAMES",["rx","ry","width","height","x","y"]);l(this,"rx",0);l(this,"ry",0);l(this,"width",0);l(this,"height",0);l(this,"x",0);l(this,"y",0)}genPath(e,t){const r=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0;let{width:i,height:a,x:o,y:h}=this;const{origin:f}=t;o+=f.x,h+=f.y;const g=r!==0||n!==0,c=1-.5522847498;e.beginPath(),e.moveTo(o+r,h),e.lineTo(o+i-r,h),g&&e.bezierCurveTo(o+i-c*r,h,o+i,h+c*n,o+i,h+n),e.lineTo(o+i,h+a-n),g&&e.bezierCurveTo(o+i,h+a-c*n,o+i-c*r,h+a,o+i-r,h+a),e.lineTo(o+r,h+a),g&&e.bezierCurveTo(o+c*r,h+a,o,h+a-c*n,o,h+a-n),e.lineTo(o,h+n),g&&e.bezierCurveTo(o,h+c*n,o+c*r,h,o+r,h),this.pathBox=new S(o,h,i,a),e.closePath()}updatePathBox(e,t){const{boxX:r,boxY:n,boxWidth:i,boxHeight:a}=e,{origin:o}=t;i<=0||a<=0||(this.x=r-o.x,this.y=n-o.y,this.width=i,this.height=a)}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{rx:t,ry:r,width:n,height:i,x:a,y:o}=e;d(t,"number"),d(r,"number"),d(n,"number"),d(i,"number"),d(a,"number"),d(o,"number")}fromJSON(e){super.fromJSON(e)}}class Ve extends ae{constructor(){super(...arguments);l(this,"type","ellipse");l(this,"ATTRIBUTE_NAMES",["x","y","radiusX","radiusY","rotation","startAngle","endAngle","anticlockwise"]);l(this,"x",0);l(this,"y",0);l(this,"radiusX",0);l(this,"radiusY",0);l(this,"rotation",0);l(this,"startAngle",0);l(this,"endAngle",0);l(this,"anticlockwise",!0)}genPath(e,t){let{x:r=0,y:n=0,radiusX:i,radiusY:a,rotation:o,startAngle:h,endAngle:f,anticlockwise:g}=this;const{origin:c}=t;e.beginPath(),o=o||0,h=h||0,f=f||2*Math.PI,r+=c.x,n+=c.y,e.ellipse(r,n,i,a,o,h,f,g),this.pathBox=new S(r-i,n-a,2*i,2*a),e.closePath()}updatePathBox(e,t){const{boxX:r,boxY:n,boxWidth:i,boxHeight:a}=e,{origin:o}=t;i<=0||a<=0||(this.radiusX=i/2,this.radiusY=a/2,this.x=r-o.x+this.radiusX,this.y=n-o.y+this.radiusY)}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{x:t,y:r,radiusX:n,radiusY:i,startAngle:a,endAngle:o,anticlockwise:h,rotation:f}=e;d(t,"number"),d(r,"number"),d(n,"number"),d(i,"number"),d(f,"number"),d(a,"number"),d(o,"number"),d(h,"boolean")}fromJSON(e){super.fromJSON(e)}}class ze extends ae{constructor(){super(...arguments);l(this,"type","arc");l(this,"ATTRIBUTE_NAMES",["x","y","radius","startAngle","endAngle","anticlockwise"]);l(this,"x",0);l(this,"y",0);l(this,"radius",0);l(this,"startAngle",0);l(this,"endAngle",0);l(this,"anticlockwise",!0)}genPath(e,t){let{x:r=0,y:n=0,radius:i,startAngle:a,endAngle:o,anticlockwise:h}=this;const{origin:f}=t;e.beginPath(),a=a||0,o=o||2*Math.PI,r=r+f.x,n=n+f.y,e.arc(r,n,i,a,o,h),this.pathBox=new S(r-i,n-i,r+i,n+i),e.closePath()}updatePathBox(e,t){throw new Error("Method not implemented.")}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{x:t,y:r,radius:n,startAngle:i,endAngle:a,anticlockwise:o}=e;d(t,"number"),d(r,"number"),d(n,"number"),d(i,"number"),d(a,"number"),d(o,"boolean")}fromJSON(e){super.fromJSON(e)}}class oe extends ae{constructor(){super(...arguments);l(this,"type","path");l(this,"ATTRIBUTE_NAMES",["path"]);l(this,"path","")}genPath(e){}updatePathBox(e,t){throw new Error("Method not implemented.")}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{path:t}=e;d(t,"string")}fromJSON(e){super.fromJSON(e)}}class $e extends ae{constructor(){super(...arguments);l(this,"type","polygon");l(this,"ATTRIBUTE_NAMES",["centerX","centerY","radius","sides","startAngle"]);l(this,"centerX",0);l(this,"centerY",0);l(this,"radius",0);l(this,"sides",0);l(this,"startAngle",0)}genPath(e,t){const r=this.getPoints(t.origin);e.beginPath(),e.moveTo(r[0].x,r[0].y);for(let n=1;n<this.sides;++n)e.lineTo(r[n].x,r[n].y);e.closePath()}getPoints(e){let{startAngle:t,centerX:r,centerY:n,sides:i,radius:a}=this;const o=[];let h=t||0;r=e.x+r,n=e.y+n;for(let f=0;f<i;++f)o.push(new v(r+a*Math.sin(h),r-a*Math.cos(h))),h+=2*Math.PI/i;return this.pathBox=new S(r-a,n-a,2*a,2*a),o}updatePathBox(e,t){throw new Error("Method not implemented.")}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{radius:t,startAngle:r,centerX:n,centerY:i,sides:a}=e;d(n,"number"),d(i,"number"),d(t,"number"),d(r,"number"),d(a,"number")}fromJSON(e){super.fromJSON(e)}}function qe(s){switch(s.type){case"rect":return Ge.createObj(Ge,s);case"arc":return ze.createObj(ze,s);case"ellipse":return Ve.createObj(Ve,s);case"path":return oe.createObj(oe,s);case"polygon":return $e.createObj($e,s);default:M(s)}}function Ct(s){if(s!==void 0)switch(s.type){case"rect":return Ge.assertJsonTrue(s);case"arc":return ze.assertJsonTrue(s);case"ellipse":return Ve.assertJsonTrue(s);case"path":return oe.assertJsonTrue(s);case"polygon":return $e.assertJsonTrue(s);default:M(s)}}class At extends G{constructor(){super(...arguments);l(this,"type","attr_clip");l(this,"ATTRIBUTE_NAMES",["d_path"]);l(this,"path");l(this,"d_path")}takeEffect(e,t){if(!this.path)return;const{origin:r,fillRule:n}=t;this.path.genPath(e,{origin:r});const{path:i}=this;if(i instanceof oe){const a=new Path2D(i.path);n==="evenodd"?e.clip(a,n):e.clip(a)}else n==="evenodd"?e.clip(n):e.clip()}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{d_path:t}=e;Ct(t)}fromJSON(e){super.fromJSON(e);const{d_path:t}=e;t&&(this.path===void 0?this.path=qe(t):t.type===this.path.type?this.path.fromJSON(t):this.path=qe(t))}}const le=class{constructor(){l(this,"assetMap",new Map)}get allAsset(){const e=[];for(const t of this.assetMap.values())e.push(t);return e}getAsset(e){let t=this.assetMap.get(e.data);return t||(t=Ur(e)),t}addAsset(e){this.assetMap.set(e.data,e)}async loadAllAsset(){return Promise.allSettled(this.allAsset.map(e=>e.load()))}static getInstance(){return le._instance||(le._instance=new le),le._instance}};let Qe=le;l(Qe,"_instance");const V=Qe.getInstance();class _r extends He{constructor(){super(...arguments);l(this,"ASSET_ATTRIBUTE",["data"]);l(this,"data","")}assertAssetUniq(){if(V.assetMap.has(this.data))throw new Error("\u8D44\u6E90\u91CD\u590D\u521B\u5EFA")}static assertJsonTrue(e){if(e===void 0)return;const{data:t}=e;super.assertJsonTrue(e),d(t,"string")}fromJSON(e){super.fromJSON(e),this.assertAssetUniq(),V.addAsset(this)}}class Ze extends _r{constructor(){super(...arguments);l(this,"type","asset_image");l(this,"ATTRIBUTE_NAMES",[...this.ASSET_ATTRIBUTE]);l(this,"element",null)}async load(){const{data:e}=this;if(this.element)return;const t=await new Promise((r,n)=>be(e,r,n));this.element=t}static assertJsonTrue(e){e!==void 0&&super.assertJsonTrue(e)}fromJSON(e){super.fromJSON(e)}}function Ur(s){switch(s.type){case"asset_image":case"asset_font":const e=new Ze;return e.fromJSON(s),e;default:M(s)}}class P extends G{constructor(){super(...arguments);l(this,"type","attr_pattern");l(this,"ATTRIBUTE_NAMES",["asset","repetition","transform"]);l(this,"repetition","repeat");l(this,"transform",{});l(this,"asset")}genPattern(e){const{repetition:t,transform:r,asset:n}=this;if(!n||!n.element)throw new Error("\u6CA1\u6709\u56FE\u7247\u8D44\u6E90\u586B\u5145");const i=e.createPattern(n.element,t!=null?t:null);return i==null||i.setTransform(r),i}static isPattern(e){return e.type==="attr_pattern"}static isPatternData(e){return e.type==="attr_pattern"}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{asset:t,repetition:r,transform:n}=e;Ze.assertJsonTrue(t),d(r,"string"),d(n,"array")}fromJSON(e){const{asset:t,transform:r}=e;super.fromJSON(e),t!==void 0&&(this.asset=V.getAsset(t)),r&&(this.transform=r)}}l(P,"repetition",["repeat","repeat-x","repeat-y","no-repeat"]);class O extends G{constructor(){super(...arguments);l(this,"type","attr_gradient");l(this,"ATTRIBUTE_NAMES",["gradientShape","gradientColors"]);l(this,"gradientColors",[]);l(this,"gradientShape",[0,0,0,0])}genGradient(e){const{gradientShape:t,gradientColors:r}=this;let n;t.length===4?n=e.createLinearGradient(...t):n=e.createRadialGradient(...t);for(const i of r)n.addColorStop(...i);return n}static isGradient(e){return e.type==="attr_gradient"}static isGradientData(e){return e.type==="attr_gradient"}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{gradientShape:t,gradientColors:r}=e;d(t,"array"),t&&Ne(t.length===4||t.length===6,"gradientShape \u6570\u7EC4\u4E0D\u7B26\u5408\u89C4\u8303"),d(r,"array")}fromJSON(e){super.fromJSON(e);const{gradientColors:t,gradientShape:r}=e;t&&(this.gradientColors=t),r&&(this.gradientShape=r)}}const Se=class extends G{constructor(){super(...arguments);l(this,"type","attr_stroke_styles");l(this,"ATTRIBUTE_NAMES",["lineDash","lineDashOffset","lineCap","lineJoin","miterLimit","lineWidth"]);l(this,"lineWidth",2);l(this,"lineDash",[]);l(this,"lineDashOffset",0);l(this,"lineCap","butt");l(this,"lineJoin","bevel");l(this,"miterLimit",0)}takeEffect(e){super.takeEffect(e),this.lineDash!==void 0&&this.setLineDash(e,this.lineDash)}setLineDash(e,t){!t||t.length===0||e.setLineDash(t)}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{lineDash:t,lineDashOffset:r,lineCap:n,lineJoin:i,miterLimit:a,lineWidth:o}=e;d(t,"array"),d(r,"number"),A(n,Se.lineCap),A(i,Se.lineJoin),d(a,"number"),d(o,"number")}fromJSON(e){super.fromJSON(e);const{lineDash:t}=e;t&&(this.lineDash=t)}};let j=Se;l(j,"lineJoin",["bevel","miter","round"]),l(j,"lineCap",["butt","round","square"]);class Pt extends G{constructor(){super(...arguments);l(this,"type","attr_shadow");l(this,"ATTRIBUTE_NAMES",["shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY"]);l(this,"shadowBlur",0);l(this,"shadowColor","#ffffff00");l(this,"shadowOffsetX",0);l(this,"shadowOffsetY",0)}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{shadowBlur:t,shadowColor:r,shadowOffsetX:n,shadowOffsetY:i}=e;d(t,"number"),d(r,"string"),d(n,"number"),d(i,"number")}fromJSON(e){super.fromJSON(e)}}const Ee=class extends G{constructor(){super(...arguments);l(this,"type","attr_font");l(this,"ATTRIBUTE_NAMES",["fontFamily","fontStyle","fontVariant","fontWeight","fontSize","lineHeight"]);l(this,"fontFamily","sans-serif");l(this,"fontSize",40);l(this,"fontStyle","normal");l(this,"fontVariant","normal");l(this,"fontWeight","normal");l(this,"lineHeight",1.16)}genFontValue(){const{fontSize:e,fontFamily:t,fontStyle:r,fontVariant:n,fontWeight:i,lineHeight:a}=this;return`${r} ${n} ${i} ${e}px${a?`/${a}`:""} ${t}`}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{fontFamily:t,fontStyle:r,fontVariant:n,fontWeight:i,fontSize:a,lineHeight:o}=e;d(t,"string"),d(a,"number"),d(o,"number"),d(n,"string"),A(r,Ee.fontStyle),A(i,Ee.fontWeight)}fromJSON(e){super.fromJSON(e)}};let fe=Ee;l(fe,"fontStyle",["normal","italic","oblique"]),l(fe,"fontWeight",["normal","bold","lighter","bolder"]);const je=class extends He{constructor(){super(...arguments);l(this,"renderParam");l(this,"fill","#ffffff00");l(this,"stroke","#ffffff00");l(this,"strokeParam",new j);l(this,"fillRule","evenodd");l(this,"shadow",new Pt);l(this,"rotate",new Bt);l(this,"coordStroke","");l(this,"filter","");l(this,"origin",new Fr);l(this,"clip",new At);l(this,"elementBox",new S);l(this,"visible",!0)}disappear(){this.visible=!1}appear(){this.visible=!0}setShadow(e){var t;(t=this.shadow)==null||t.takeEffect(e)}setRotate(e){this.rotate.takeEffect(e)}renderBefore(e){this.setRotate(e)}renderCoord(e){const{coordStroke:t,origin:r}=this,{x:n,y:i}=r;t&&(e.beginPath(),e.moveTo(n+20,i),e.lineTo(n,i),e.lineTo(n,20+i),e.strokeStyle=t,e.stroke())}renderAfter(e){this.countElementBox(e),this.rotate.elementBox=this.elementBox,this.renderCoord(e)}setContextParam(e){this.setClip(e),this.setShadow(e),this.setFilter(e),this.setFill(e),this.setStroke(e)}setStroke(e){const{stroke:t,strokeParam:r}=this;!t||(r==null?void 0:r.lineWidth)===0||(typeof t=="string"?e.strokeStyle=t:O.isGradient(t)?e.strokeStyle=t.genGradient(e):P.isPattern(t)&&(e.strokeStyle=t.genPattern(e)||""),this.strokeParam.takeEffect(e))}setFill(e){const{fill:t}=this;!t||(typeof t=="string"?e.fillStyle=t:O.isGradient(t)?e.fillStyle=t.genGradient(e):P.isPattern(t)&&(e.fillStyle=t.genPattern(e)||""))}setFilter(e){const{filter:t}=this;t&&(e.filter=t)}setClip(e){var n;const{fillRule:t,origin:r}=this;(n=this.clip)==null||n.takeEffect(e,{fillRule:t,origin:r})}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{strokeParam:t,shadow:r,rotate:n,fill:i,stroke:a,clip:o,origin:h,fillRule:f,filter:g}=e;d(h==null?void 0:h.x,"number"),d(h==null?void 0:h.y,"number"),!!i&&typeof i!="string"&&(i.gradientShape?O.assertJsonTrue(i):i.asset!==void 0&&P.assertJsonTrue(i)),!!a&&typeof a!="string"&&(a.gradientShape?O.assertJsonTrue(a):a.asset!==void 0&&P.assertJsonTrue(a)),Bt.assertJsonTrue(n),At.assertJsonTrue(o),A(f,je.fillRule),j.assertJsonTrue(t),Pt.assertJsonTrue(r),d(g,"string")}fromJSON(e){super.fromJSON(e);const{strokeParam:t,shadow:r,rotate:n,fill:i,stroke:a,clip:o}=e;e.origin&&this.origin.fromJSON(e.origin),!!i&&typeof i!="string"&&(O.isGradientData(i)&&(O.isGradient(this.fill)?this.fill.fromJSON(i):(this.fill=new O,this.fill.fromJSON(i))),P.isPatternData(i)&&(P.isPattern(this.fill)?this.fill.fromJSON(i):(this.fill=new P,this.fill.fromJSON(i)))),!!a&&typeof a!="string"&&(O.isGradientData(a)&&(O.isGradient(this.stroke)?this.stroke.fromJSON(a):(this.stroke=new O,this.stroke.fromJSON(a))),P.isPatternData(a)&&(P.isPattern(this.stroke)?this.stroke.fromJSON(a):(this.stroke=new P,this.stroke.fromJSON(a)))),t&&this.strokeParam.fromJSON(t),r&&this.shadow.fromJSON(r),n&&this.rotate.fromJSON(n),o&&this.clip.fromJSON(o)}};let W=je;l(W,"ELEMENT_ATTRIBUTES",["fill","stroke","fillRule","strokeParam","rotate","origin","shadow","filter","clip"]),l(W,"fillRule",["evenodd","nonzero"]);class Ke extends W{constructor(){super();l(this,"ATTRIBUTE_NAMES",["d_path"]);l(this,"type","shape");l(this,"d_path");l(this,"path");this.ATTRIBUTE_NAMES.push(...W.ELEMENT_ATTRIBUTES)}render(e,t){!this.path||(this.renderParam=t,e.save(),this.renderBefore(e),this.renderFillStroke(e),this.renderAfter(e),e.restore())}renderBefore(e){const{origin:t}=this;!this.path||(super.renderBefore(e),this.path.takeEffect(e,{origin:t}))}countElementBox(e){!this.path||(this.elementBox=this.path.pathBox)}updateElementBox(e){if(!this.path)return;const{origin:t}=this;this.path.updatePathBox(e,{origin:t})}renderFillStroke(e){this.setContextParam(e),this.renderFill(e),this.renderStroke(e)}renderStroke(e){const{path:t}=this;t instanceof oe?e.stroke(new Path2D(t.path)):e.stroke()}renderFill(e){const{path:t}=this;if(t instanceof oe){const r=new Path2D(t.path);this.fillRule==="evenodd"?e.fill(r,"evenodd"):e.fill(r)}else this.fillRule==="evenodd"?e.fill("evenodd"):e.fill()}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{d_path:t}=e;Ct(t)}fromJSON(e){super.fromJSON(e);const{d_path:t}=e;t&&(this.path?this.path.fromJSON(t):this.path=qe(t))}}const pe=class extends W{constructor(){super();l(this,"type","text");l(this,"ATTRIBUTE_NAMES",["font","text","textAlign","textBaseline","direction","border","background"]);l(this,"textBox",new te);l(this,"font",new fe);l(this,"text","");l(this,"border","#ffffff00");l(this,"background","#ffffff00");l(this,"textAlign","left");l(this,"textBaseline","top");l(this,"direction","inherit");this.ATTRIBUTE_NAMES.push(...W.ELEMENT_ATTRIBUTES)}setTextStyles(e){const{font:t,textBaseline:r,textAlign:n,direction:i}=this;e.textBaseline=r,e.textAlign=n,typeof t=="string"?e.font=t:e.font=t.genFontValue(),e.direction=i}renderBefore(e){super.renderBefore(e),this.setContextParam(e),this.setTextStyles(e)}renderBorderAndBackground(e){const{textBox:t,border:r,background:n}=this;if(!t||!r&&!n)return;const{boxX:i,boxY:a,boxWidth:o,boxHeight:h}=t;e.save();const f={type:"shape",d_path:{type:"rect",width:o,height:h,x:i,y:a},stroke:r||"#ffffff00",fill:n||"#ffffff00",strokeParam:{lineWidth:1,lineCap:"square",lineJoin:"round",lineDashOffset:0,lineDash:[]}};Ke.createObj(Ke,f).render(e),e.restore()}countElementBox(e){this.elementBox=this.textBox}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{font:t,text:r,textAlign:n,textBaseline:i,direction:a,border:o,background:h}=e;fe.assertJsonTrue(t),d(r,"string"),d(h,"string"),d(o,"string"),A(i,pe.textBaseline),A(n,pe.textAlign),A(a,pe.direction)}};let he=pe;l(he,"textAlign",["center","end","left","right","start"]),l(he,"textBaseline",["alphabetic","bottom","hanging","ideographic","middle","top"]),l(he,"direction",["inherit","ltr","rtl"]);class Yr extends he{constructor(){super(...arguments);l(this,"type","text");l(this,"ATTRIBUTE_NAMES",[...this.ATTRIBUTE_NAMES])}updateElementBox(e){throw new Error("Method not implemented.")}countTextBox(e){const t=e.measureText(this.text);this.textBox=de(t,this.origin.toPoint(),this.font.fontSize,this.text)}render(e){!this.text||(e.save(),this.renderBefore(e),this.countTextBox(e),this.renderBorderAndBackground(e),this.renderText(e),this.renderAfter(e),e.restore())}renderText(e){e.strokeText(this.text,this.origin.x,this.origin.y),e.fillText(this.text,this.origin.x,this.origin.y)}static assertJsonTrue(e){e!==void 0&&super.assertJsonTrue(e)}fromJSON(e){super.fromJSON(e);const{font:t}=e;t&&this.font.fromJSON(t)}}class ee extends he{constructor(){super(...arguments);l(this,"ATTRIBUTE_NAMES",["width","height",...this.ATTRIBUTE_NAMES]);l(this,"type","paragraph");l(this,"width");l(this,"height");l(this,"textLineBox",[]);l(this,"tempBox")}get textLine(){return ke(this.text)}render(e){if(!!this.text){if(e.save(),this.renderBefore(e),this.updateText(e)){e.restore(),this.render(e);return}this.countTextBox(e),this.renderBorderAndBackground(e),this.renderText(e),this.renderAfter(e),e.restore()}}updateText(e){const{textLine:t,text:r}=this;return ht(t,e,this.width),this.text=t.join(""),r!==this.text}renderText(e){const{textLine:t,textLineBox:r}=this;for(let n=0;n<r.length;n++){const i=t[n];if(!i)return;const a=r[n],{x:o,y:h}=a;e.strokeText(i,o,h),e.fillText(i,o,h)}}countTextBox(e){const{textLine:t,origin:r,textLineBox:n}=this;let{x:i,y:a}=r;for(let o=0;o<t.length;o++){const h=e.measureText(t[o]),f=de(h,new v(i,a),this.font.fontSize,t[o]);n[o]=f,a+=f.boxHeight}this.textBox=ot(n),this.textBox.boxHeight>this.height&&(this.height=this.textBox.boxHeight)}updateElementBox(e){const{boxX:t,boxY:r,boxWidth:n,boxHeight:i}=e,{origin:a}=this;t&&(a.x=t),r&&(a.y=r),n&&(this.width=n),i&&(this.height=i)}countElementBox(e){super.countElementBox(e);const{elementBox:t,width:r,height:n}=this;t.boxWidth=r,t.boxHeight=n}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{width:t,height:r}=e;d(t,"number"),d(r,"number")}fromJSON(e){super.fromJSON(e);const{font:t}=e;t&&this.font.fromJSON(t)}}const et=class extends W{constructor(){super();l(this,"type","image");l(this,"ATTRIBUTE_NAMES",["asset","width","height","imageSmoothing","imageSmoothingQuality"]);l(this,"asset");l(this,"width",0);l(this,"height",0);l(this,"imageSmoothing",!0);l(this,"imageSmoothingQuality","medium");this.ATTRIBUTE_NAMES.push(...W.ELEMENT_ATTRIBUTES)}setImageSmoothing(e){e.imageSmoothingEnabled=this.imageSmoothing,e.imageSmoothingQuality=this.imageSmoothingQuality}render(e){const{width:t,height:r,asset:n}=this;if(!n||!n.element)throw new Error("\u6CA1\u6709\u56FE\u7247\u8D44\u6E90\u586B\u5145");!n||!n.element||!t||!r||(e.save(),this.renderBefore(e),this.renderImage(e,n),this.renderAfter(e),e.restore())}renderBefore(e){super.renderBefore(e),this.setImageSmoothing(e),this.setContextParam(e),this.setImageSmoothing(e)}renderImage(e,t){const{x:r,y:n}=this.origin,{width:i,height:a}=this;e.drawImage(t.element,r,n,i,a)}updateElementBox(e){const{boxX:t,boxY:r,boxWidth:n,boxHeight:i}=e,{origin:a}=this;t&&(a.x=t),r&&(a.y=r),n&&(this.width=n),i&&(this.height=i)}countElementBox(e){const{elementBox:t,width:r,height:n,origin:i}=this;t.boxX=i.x,t.boxY=i.y,t.boxWidth=r,t.boxHeight=n}static assertJsonTrue(e){if(e===void 0)return;super.assertJsonTrue(e);const{asset:t,width:r,height:n,imageSmoothing:i,imageSmoothingQuality:a}=e;Ze.assertJsonTrue(t),d(r,"number"),d(n,"number"),d(i,"boolean"),A(a,et.imageSmoothingQuality)}fromJSON(e){const{asset:t}=e;super.fromJSON(e),t!==void 0&&(this.asset=V.getAsset(t))}};let ce=et;l(ce,"imageSmoothingQuality",["high","low","medium"]);function Xr(s){switch(s.type){case"shape":return Ke.assertJsonTrue(s);case"image":return ce.assertJsonTrue(s);case"text":return Yr.assertJsonTrue(s);case"paragraph":return ee.assertJsonTrue(s);default:M(s)}}const kt={gradientColors:{title:"gradientColors",type:"array",widget:"gradientInput"},gradientShape:{title:"gradientShape",type:"array",widget:"gradientInput"}},Wr={strokeType:{title:"\u63CF\u8FB9\u7C7B\u578B",description:"\u4E0B\u62C9\u5355\u9009",type:"string",enum:["strokeColor","strokeGradient","strokePattern"],enumNames:["\u63CF\u8FB9\u989C\u8272","\u63CF\u8FB9\u6E10\u53D8","\u63CF\u8FB9\u6A21\u5F0F"],widget:"select",labelWidth:160},strokeColor:{title:"\u63CF\u8FB9\u989C\u8272",type:"string",hidden:"{{formData.strokeType !== 'strokeColor'}}",format:"color",props:{}},strokeGradient:{title:"\u63CF\u8FB9\u6E10\u53D8",type:"object",hidden:"{{formData.strokeType !== 'strokeGradient'}}",properties:E({},kt)},strokePattern:{title:"\u63CF\u8FB9\u6A21\u5F0F",type:"object",hidden:"{{formData.strokeType !== 'strokePattern'}}",properties:{imageData:{title:"\u56FE\u7247",type:"string",widget:"imageUpload"},repetition:{title:"repetition",description:"\u4E0B\u62C9\u5355\u9009",type:"string",enum:P.repetition,enumNames:P.repetition,widget:"select",labelWidth:160}}},strokeParam:{title:"strokeParam",type:"object",properties:{lineWidth:{title:"lineWidth",type:"number"},lineJoin:{title:"lineJoin",description:"\u4E0B\u62C9\u5355\u9009",type:"string",enum:j.lineJoin,enumNames:["bevel","miter","round"],widget:"select",labelWidth:160},miterLimit:{title:"miterLimit",type:"number",hidden:!0},lineDash:{title:"lineDash",type:"array",items:{type:"object",properties:{interval:{title:"\u7EBF\u6761\u95F4\u9694",type:"number"}}}},lineDashOffset:{title:"lineDashOffset",type:"number",hidden:"{{!formData.strokeParam.lineDash || formData.strokeParam.lineDash.length === 0 || !formData.strokeParam.lineDash[0].interval || formData.strokeParam.lineDash[0].interval < 0}}"},lineCap:{title:"lineCap",description:"\u4E0B\u62C9\u5355\u9009",type:"string",enum:j.lineCap,enumNames:["butt","round","square"],widget:"select",labelWidth:160,hidden:"{{!formData.strokeParam.lineDash || formData.strokeParam.lineDash.length === 0 || !formData.strokeParam.lineDash[0].interval || formData.strokeParam.lineDash[0].interval < 0}}"}}}},Lr={fillType:{title:"\u586B\u5145\u7C7B\u578B",description:"\u4E0B\u62C9\u5355\u9009",type:"string",enum:["fillColor","fillGradient","fillPattern"],enumNames:["\u586B\u5145\u989C\u8272","\u586B\u5145\u6E10\u53D8","\u586B\u5145\u6A21\u5F0F"],widget:"select",labelWidth:160},fillColor:{title:"\u586B\u5145\u989C\u8272",type:"string",hidden:"{{formData.fillType !== 'fillColor'}}",format:"color",props:{}},fillGradient:{title:"\u586B\u5145\u6E10\u53D8",type:"object",hidden:"{{formData.fillType !== 'fillGradient'}}",properties:E({},kt)},fillPattern:{title:"\u586B\u5145\u6A21\u5F0F",type:"object",hidden:"{{formData.fillType !== 'fillPattern'}}",properties:{imageData:{title:"\u56FE\u7247",type:"string",widget:"imageUpload"},repetition:{title:"repetition",description:"\u4E0B\u62C9\u5355\u9009",type:"string",enum:P.repetition,enumNames:P.repetition,widget:"select",labelWidth:160}}},fillRule:{title:"fillRule",description:"\u4E0B\u62C9\u5355\u9009",type:"string",enum:W.fillRule,enumNames:["\u5947\u5076\u89C4\u5219","\u975E\u96F6\u89C4\u5219"],widget:"select",labelWidth:160}},Hr={imageData:{title:"\u56FE\u7247",type:"string",widget:"imageUpload"},width:{title:"width",type:"number",min:0},height:{title:"width",type:"number",min:0},imageSmoothing:{title:"imageSmoothing",type:"boolean"},imageSmoothingQuality:{title:"imageSmoothing",type:"string",enum:ce.imageSmoothingQuality,enumNames:ce.imageSmoothingQuality,widget:"select",labelWidth:160}},Gr={width:{title:"width",type:"number",min:0},height:{title:"width",type:"number",min:0},text:{title:"text",type:"string",format:"textarea",props:{row:4}},textAlign:{title:"textAlign",type:"string",enum:ee.textAlign,enumNames:ee.textAlign,widget:"select",labelWidth:160},textBaseline:{title:"direction",type:"string",enum:ee.textBaseline,enumNames:ee.textBaseline,widget:"select",labelWidth:160},direction:{title:"direction",type:"string",enum:ee.direction,enumNames:ee.direction,widget:"select",labelWidth:160},font:{title:"\u5B57\u4F53",type:"object",properties:{fontSize:{title:"fontSize",type:"number"},fontFamily:{title:"fontFamily",type:"string"},fontStyle:{title:"fontStyle",type:"string"},fontVariant:{title:"fontVariant",type:"string"},fontWeight:{title:"fontWeight",type:"string"},lineHeight:{title:"lineHeight",type:"number"}}}},Jt={d_path:{title:"\u8DEF\u5F84\u914D\u7F6E",type:"object",properties:{type:{title:"\u8DEF\u5F84\u7C7B\u578B",type:"string",enum:["ellipse","rect"],enumNames:["\u692D\u5706","\u56DB\u8FB9\u5F62"],widget:"select",labelWidth:160,readOnly:"{{formData.type === 'shape'}}"},ellipseData:{title:"\u692D\u5706\u914D\u7F6E",type:"object",hidden:"{{rootValue.type !== 'ellipse'}}",properties:{x:{title:"x",type:"number",min:0},y:{title:"y",type:"number",min:0},radiusX:{title:"radiusX",type:"number",min:0},radiusY:{title:"radiusY",type:"number",min:0},startAngle:{title:"startAngle",type:"number",min:0},endAngle:{title:"endAngle",type:"number",min:0},anticlockwise:{title:"anticlockwise",type:"boolean"}}},rectData:{title:"\u56DB\u8FB9\u5F62\u914D\u7F6E",type:"object",hidden:"{{rootValue.type !== 'rect'}}",properties:{x:{title:"x",type:"number",min:0},y:{title:"y",type:"number",min:0},width:{title:"width",type:"number",min:0},height:{title:"height",type:"number",min:0},rx:{title:"rx",type:"number",min:0},ry:{title:"ry",type:"number",min:0}}}}}},Vr={type:"object",properties:I(E(E({type:{type:"string",readonly:!0},origin:{title:"Origin",type:"object",properties:{x:{title:"\u6E90\u70B9\u7684X\u5750\u6807",type:"number"},y:{title:"\u6E90\u70B9\u7684Y\u5750\u6807",type:"number"}}},rotate:{title:"rotate",type:"object",properties:{angle:{title:"\u6E32\u67D3\u7684\u89D2\u5EA6",type:"number",min:0}}},shadow:{title:"\u9634\u5F71",type:"object",properties:{shadowBlur:{title:"shadowBlur",type:"number",min:0},shadowColor:{title:"shadowColor",type:"string",format:"color"},shadowOffsetX:{title:"shadowOffsetX",type:"number",min:0},shadowOffsetY:{title:"shadowOffsetY",type:"number",min:0}}},clip:{title:"\u526A\u5207\u914D\u7F6E",type:"object",hidden:"{{formData.type === 'shape'}}",properties:E({},Jt)}},Wr),Lr),{imageData:{title:"\u56FE\u50CF\u914D\u7F6E",type:"object",hidden:"{{formData.type !== 'image'}}",properties:E({},Hr)},paragraphData:{title:"\u6587\u672C\u914D\u7F6E",type:"object",hidden:"{{formData.type !== 'paragraph'}}",properties:E({},Gr)},shapeData:{title:"\u56FE\u5F62\u914D\u7F6E",type:"object",hidden:"{{formData.type !== 'shape'}}",properties:E({},Jt)}}),labelWidth:120,displayType:"row"};function zr(s){const{origin:e,fill:t,stroke:r,fillRule:n,strokeParam:i,clip:a}=s,o={};if(o.type=s.type,o.origin={x:e.x,y:e.y},a.path){o.clip={};const h=o.clip.d_path={};Dt(a.path,h)}o.rotate={},B(o.rotate,s.rotate,s.rotate.ATTRIBUTE_NAMES),o.shadow={},B(o.shadow,s.shadow,s.shadow.ATTRIBUTE_NAMES);{if(typeof r=="string")o.strokeType="strokeColor",o.strokeColor=r;else if(O.isGradient(r))o.strokeType="strokeGradient",o.strokeGradient={gradientColors:Array.from(r.gradientColors),gradientShape:Array.from(r.gradientShape)};else if(P.isPattern(r)){o.strokeType="strokePattern";const h=V.getAsset(r.asset);o.strokePattern={repetition:r.repetition,imageData:h==null?void 0:h.data}}else throw new Error("\u6682\u4E0D\u652F\u6301");if(i){const h={};B(h,i,i.ATTRIBUTE_NAMES);const{lineDash:f}=i;if(f!==void 0){const g=[];for(const c of f)g.push({interval:c});h.lineDash=g}o.strokeParam=h}}{if(typeof t=="string")o.fillType="fillColor",o.fillColor=t;else if(O.isGradient(t))o.fillType="fillGradient",o.fillGradient={gradientColors:Array.from(t.gradientColors),gradientShape:Array.from(t.gradientShape)};else if(P.isPattern(t)){o.fillType="fillPattern";const h=V.getAsset(t.asset);o.fillPattern={repetition:t.repetition,imageData:h==null?void 0:h.data}}else throw new Error("\u6682\u4E0D\u652F\u6301");n&&(o.fillRule=n)}return s.type==="image"&&(o.imageData={},qr(s,o.imageData)),s.type==="paragraph"&&(o.paragraphData={},$r(s,o.paragraphData)),s.type==="shape"&&(o.shapeData={},Qr(s,o.shapeData)),o}function $r(s,e){B(e,s,s.ATTRIBUTE_NAMES),e.font={},B(e.font,s.font,s.font.ATTRIBUTE_NAMES)}function qr(s,e){B(e,s,s.ATTRIBUTE_NAMES);{const t=V.getAsset(s.asset);e.imageData=t==null?void 0:t.data}}function Qr(s,e){if(B(e,s,s.ATTRIBUTE_NAMES),s.path){const t=e.d_path={};Dt(s.path,t)}}function Dt(s,e){e.type=s.type,s.type==="ellipse"?(e.ellipseData={},B(e.ellipseData,s,s.ATTRIBUTE_NAMES)):s.type==="rect"&&(e.rectData={},B(e.rectData,s,s.ATTRIBUTE_NAMES))}function Zr(s,e){var n,i,a;const{clip:t}=e,r={};if(r.type=e.type,r.origin=s.origin,s.clip!==void 0){const{d_path:o}=s.clip;o&&o.type&&t.fromJSON({d_path:E({type:o.type},o[o.type+"Data"])})}if(r.rotate={},B(r.rotate,s.rotate,e.rotate.ATTRIBUTE_NAMES),r.shadow={},B(r.shadow,s.shadow,e.shadow.ATTRIBUTE_NAMES),s.strokeParam!==void 0){const{lineDash:o}=s.strokeParam,h=r.strokeParam={};if(B(h,s.strokeParam,e.strokeParam.ATTRIBUTE_NAMES),o!==void 0){const f=[];for(const g of o)f.push((n=g.interval)!=null?n:0);h.lineDash=f}}if(s.strokeType!==void 0)if(s.strokeType==="strokeColor")r.stroke=(i=s[s.strokeType])!=null?i:"";else if(s.strokeType==="strokeGradient"){const{gradientColors:o,gradientShape:h}=s[s.strokeType];r.stroke={type:"attr_gradient",gradientColors:o,gradientShape:h}}else if(s.strokeType==="strokePattern"){const{imageData:o,repetition:h}=s[s.strokeType];r.stroke={type:"attr_pattern",repetition:h,asset:{type:"asset_image",data:o}}}else throw new Error("\u6682\u4E0D\u652F\u6301");if(s.fillType!==void 0)if(s.fillType==="fillColor")r.fill=(a=s[s.fillType])!=null?a:"";else if(s.fillType==="fillGradient"){const{gradientColors:o,gradientShape:h}=s[s.fillType];r.fill={type:"attr_gradient",gradientColors:o,gradientShape:h}}else if(s.fillType==="fillPattern"){const{imageData:o,repetition:h}=s[s.fillType];r.fill={type:"attr_pattern",repetition:h,asset:{type:"asset_image",data:o}}}else throw new Error("\u6682\u4E0D\u652F\u6301");return r.fillRule=s.fillRule,r.type==="image"&&s.imageData!==void 0&&jr(r,s.imageData,e),r.type==="paragraph"&&s.paragraphData!==void 0&&Kr(r,s.paragraphData,e),r.type==="shape"&&s.shapeData!==void 0&&en(r,s.shapeData,e),r}function Kr(s,e,t){B(s,e,t.ATTRIBUTE_NAMES),e.font!==void 0&&(s.font={},B(s.font,e.font,t.font.ATTRIBUTE_NAMES))}function jr(s,e,t){if(B(s,e,t.ATTRIBUTE_NAMES),e.imageData!==void 0){const r=V.getAsset(t.asset);e.imageData&&(r==null?void 0:r.data)!==e.imageData&&(s.asset={type:"asset_image",data:e.imageData})}}function en(s,e,t){e.d_path!==void 0&&t.path&&(s.d_path={type:e.d_path.type},tn(t.path,e.d_path,s.d_path))}function tn(s,e,t){t.type==="ellipse"?B(t,e.ellipseData,s.ATTRIBUTE_NAMES):t.type==="rect"&&B(t,e.rectData,s.ATTRIBUTE_NAMES)}function rn(s){const{value:e,onChange:t}=s,r=nn(s.schema.$id.split(".")),[n,i]=y.exports.useState([]);y.exports.useEffect(()=>{i(e)},[e]);function a(c){if(i(c),r==="gradientShape"&&c.length!==4&&c.length!==6){Pe.warn("gradientShape \u7684\u957F\u5EA6\u5FC5\u987B\u662F 4 \u6216 6");return}t(c)}function o(c,m){const x=Array.from(n);x[m]=c,a(x)}function h(c,m,x){const T=Array.from(n);T[m][x]=c,a(T)}function f(c){const m=Array.from(n);m.splice(c,1),a(m)}function g(){const c=Array.from(n);c.push(r==="gradientShape"?1:[0,"#000000"]),a(c)}return C("div",{style:{display:"flex",flexDirection:"column"},children:[p(_t,{style:{display:"flex",flexWrap:"wrap"},children:Array.isArray(n)&&n.map((c,m)=>C("div",{children:[r==="gradientShape"&&C(Ae,{children:[p(rt,{size:"small",min:0,defaultValue:c,style:{width:80},onChange:x=>o(x,m)}),p(nt,{onClick:()=>f(m)})]}),r==="gradientColors"&&C("div",{style:{display:"flex"},children:[p(rt,{size:"small",defaultValue:c[0],min:0,max:1,step:.1,onChange:x=>h(x,m,0)}),p(Ut,{animation:"slide-up",color:c[1],onChange:({color:x})=>h(x,m,1)}),p(nt,{onClick:()=>f(m)})]})]},m))}),p(Yt,{onClick:g,children:"\u589E\u52A0\u4E00\u6761"})]})}function nn(s=[]){return s[s.length-1]}function sn(s,e){const t=new FileReader;t.addEventListener("load",()=>e(t.result)),t.readAsDataURL(s)}function an(s){const{value:e,onChange:t}=s,[r,n]=y.exports.useState(!1),i=h=>{if(h.file.status==="uploading"){n(!0);return}h.file.status==="done"&&sn(h.file.originFileObj,f=>{n(!1),t(f)})};function a(h){const f=h.type==="image/jpeg"||h.type==="image/png";f||Pe.error("You can only upload JPG/PNG file!");const g=h.size/1024/1024<2;return g||Pe.error("Image must smaller than 2MB!"),f&&g}return p(Xt,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",beforeUpload:a,onChange:i,children:e?p("img",{src:e,alt:"avatar",style:{width:"100%"}}):C("div",{children:[r?p(Wt,{}):p(Lt,{}),p("div",{style:{marginTop:8},children:"Upload"})]})})}const on=y.exports.forwardRef((s,e)=>{const{eleRef:t,update:r}=s,n=Ht(),i=y.exports.useRef(!1);y.exports.useImperativeHandle(e,()=>({settingUpdate:()=>{if(!t.current)return;i.current=!0;const o=Zt(zr(t.current));n.setValues(o)},AA:()=>{}}));const a=o=>{if(!!t.current)try{const h=Zr(o,t.current);Xr(h),t.current.fromJSON(h),r()}catch(h){console.log("catch",h)}};return t.current?p(Gt,{form:n,schema:Vr,widgets:{imageUpload:an,gradientInput:rn},watch:{"#":{immediate:!1,handler:o=>a(o)}}}):p("div",{})});function hn(){return p("div",{})}function ln(s){const{data:e}=s,t=y.exports.useRef(null),r=y.exports.useRef(null),n=y.exports.useRef(null),i=y.exports.useRef(null),a=y.exports.useRef(!1),o=y.exports.useCallback(Kt(()=>{var g;(g=n.current)==null||g.settingUpdate()},300),[]),h=y.exports.useCallback(()=>{r.current.loadAssets().then(()=>{var g;a.current=!0,(g=r.current)==null||g.update()})},[]),f=g=>{if(a.current){a.current=!1;return}g!==void 0&&(i.current=g),o()};return y.exports.useEffect(()=>{r.current=new Mr(I(E({container:t.current},e),{eleChange:f})),h()},[]),C("div",{className:"canvas-editor-container",children:[p(hn,{}),p("div",{className:"canvas",children:p("div",{ref:t,style:{border:"1px solid red"}})}),p("div",{className:"settings",children:p(on,{ref:n,eleRef:i,update:h})})]})}const un={width:600,height:600,layers:[{type:"shape",d_path:{type:"rect",rx:5,ry:10,width:100,height:80},origin:{x:300,y:10},fill:"yellow",stroke:"red"},{type:"shape",d_path:{type:"ellipse",radiusX:50,radiusY:100},origin:{x:50,y:300},fill:"red"},{type:"paragraph",text:"123",origin:{x:300,y:300},fill:"black",width:200,height:200},{type:"paragraph",text:"456",font:{},origin:{x:100,y:400},fill:"black",width:200,height:200},{type:"image",asset:{type:"asset_image",data:se("images/logo.png")},width:200,height:200,fill:"#ffffff00",stroke:"#ffffff00"}],dpr:2};var dn=()=>p(ln,{data:un});const{SubMenu:Nt}=J,{Header:fn,Content:cn}=Vt;function gn(){const[s,e]=y.exports.useState("canvas-editor"),[t,r]=y.exports.useState(""),n=y.exports.useCallback(a=>{const o=a.key.split(":");e(o[0]),r(o[1])},[]),i=()=>{switch(s){case"canvas-json":return p(pr,{subModule:t});case"canvas-input":return p(Tr,{});case"canvas-shared":return p(Dr,{subModule:t});case"canvas-transform":return p(Rr,{});case"canvas-editor":return p(dn,{});default:return p("div",{})}};return C("div",{style:{background:"antiquewhite",height:"100vh",display:"flex",flexDirection:"column"},children:[p(fn,{style:{padding:"0"},children:C(J,{onClick:n,selectedKeys:[s],mode:"horizontal",children:[C(Nt,{title:"\u52A0\u8F7DJSON",children:[p(J.Item,{children:"\u6587\u672C"},"canvas-json:text"),p(J.Item,{children:"\u56FE\u5F62"},"canvas-json:shape"),p(J.Item,{children:"\u56FE\u50CF"},"canvas-json:image"),p(J.Item,{children:"\u88C1\u526A"},"canvas-json:clip"),p(J.Item,{children:"\u6E10\u53D8\u6A21\u578B"},"canvas-json:gradient-pattern")]},"canvas-json"),p(J.Item,{children:"\u5143\u7D20\u53D8\u6362"},"canvas-transform"),p(J.Item,{children:"\u6587\u672C\u8F93\u5165"},"canvas-input"),C(Nt,{title:"\u516C\u5171\u65B9\u6CD5",children:[p(J.Item,{children:"\u900F\u660E\u5EA6"},"canvas-shared:transparent"),p(J.Item,{children:"\u70B9\u53D8\u6362"},"canvas-shared:point-transform"),p(J.Item,{children:"box \u53D8\u6362"},"canvas-shared:box-transform")]},"canvas-shared"),p(J.Item,{children:"\u7F16\u8F91\u5668"},"canvas-editor")]})}),p(cn,{children:p("div",{style:{display:"flex",justifyContent:"center",height:"100%"},children:i()})})]})}zt.render(p(gn,{}),document.getElementById("root"));
